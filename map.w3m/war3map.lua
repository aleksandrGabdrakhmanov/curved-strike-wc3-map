gg_rct_curved_team_1_attack_1_right = nil
gg_rct_curved_1_1_build = nil
gg_rct_curved_1_1_main = nil
gg_rct_curved_1_1_mine = nil
gg_rct_curved_1_1_spawn = nil
gg_rct_curved_1_1_worker = nil
gg_rct_curved_1_2_build = nil
gg_rct_curved_1_2_main = nil
gg_rct_curved_1_2_mine = nil
gg_rct_curved_1_2_spawn = nil
gg_rct_curved_1_2_worker = nil
gg_rct_curved_1_3_build = nil
gg_rct_curved_1_3_main = nil
gg_rct_curved_1_3_mine = nil
gg_rct_curved_1_3_spawn = nil
gg_rct_curved_1_3_worker = nil
gg_rct_curved_1_4_build = nil
gg_rct_curved_1_4_main = nil
gg_rct_curved_1_4_mine = nil
gg_rct_curved_1_4_spawn = nil
gg_rct_curved_1_4_worker = nil
gg_rct_curved_1_5_build = nil
gg_rct_curved_1_5_main = nil
gg_rct_curved_1_5_mine = nil
gg_rct_curved_1_5_spawn = nil
gg_rct_curved_1_5_worker = nil
gg_rct_curved_2_1_build = nil
gg_rct_curved_2_1_main = nil
gg_rct_curved_2_1_mine = nil
gg_rct_curved_2_1_spawn = nil
gg_rct_curved_2_1_worker = nil
gg_rct_curved_2_2_build = nil
gg_rct_curved_2_2_main = nil
gg_rct_curved_2_2_mine = nil
gg_rct_curved_2_2_spawn = nil
gg_rct_curved_2_2_worker = nil
gg_rct_curved_2_3_build = nil
gg_rct_curved_2_3_main = nil
gg_rct_curved_2_3_mine = nil
gg_rct_curved_2_3_spawn = nil
gg_rct_curved_2_3_worker = nil
gg_rct_curved_2_4_build = nil
gg_rct_curved_2_4_main = nil
gg_rct_curved_2_4_mine = nil
gg_rct_curved_2_4_spawn = nil
gg_rct_curved_2_4_worker = nil
gg_rct_curved_2_5_build = nil
gg_rct_curved_2_5_main = nil
gg_rct_curved_2_5_mine = nil
gg_rct_curved_2_5_spawn = nil
gg_rct_curved_2_5_worker = nil
gg_rct_curved_team_1_base = nil
gg_rct_curved_team_1_tower = nil
gg_rct_curved_team_2_base = nil
gg_rct_curved_team_2_tower = nil
gg_rct_curved_1_1_laboratory = nil
gg_rct_curved_1_2_laboratory = nil
gg_rct_curved_1_3_laboratory = nil
gg_rct_curved_1_4_laboratory = nil
gg_rct_curved_1_5_laboratory = nil
gg_rct_curved_2_1_laboratory = nil
gg_rct_curved_2_2_laboratory = nil
gg_rct_curved_2_3_laboratory = nil
gg_rct_curved_2_4_laboratory = nil
gg_rct_curved_2_5_laboratory = nil
gg_rct_curved_team_2_attack_1_left = nil
gg_rct_curved_1_1_shop = nil
gg_rct_curved_1_2_shop = nil
gg_rct_curved_1_3_shop = nil
gg_rct_curved_1_4_shop = nil
gg_rct_curved_1_5_shop = nil
gg_rct_curved_2_1_shop = nil
gg_rct_curved_2_2_shop = nil
gg_rct_curved_2_3_shop = nil
gg_rct_curved_2_4_shop = nil
gg_rct_curved_2_5_shop = nil
gg_rct_curved_1_1_image = nil
gg_rct_curved_1_2_image = nil
gg_rct_curved_1_3_image = nil
gg_rct_curved_1_4_image = nil
gg_rct_curved_1_5_image = nil
gg_rct_curved_2_1_image = nil
gg_rct_curved_2_2_image = nil
gg_rct_curved_2_3_image = nil
gg_rct_curved_2_4_image = nil
gg_rct_curved_2_5_image = nil
gg_rct_curved_team_1_addGold = nil
gg_rct_curved_team_2_addGold = nil
function InitGlobals()
end

function CreateRegions()
local we

gg_rct_curved_team_1_attack_1_right = Rect(-12672.0, 3552.0, -2464.0, 8992.0)
gg_rct_curved_1_1_build = Rect(-14400.0, 9152.0, -13248.0, 10816.0)
gg_rct_curved_1_1_main = Rect(-14912.0, 9664.0, -14400.0, 10176.0)
gg_rct_curved_1_1_mine = Rect(-14912.0, 9152.0, -14400.0, 9664.0)
gg_rct_curved_1_1_spawn = Rect(-12672.0, 5440.0, -11520.0, 7104.0)
gg_rct_curved_1_1_worker = Rect(-14400.0, 9152.0, -13248.0, 10816.0)
gg_rct_curved_1_2_build = Rect(-14400.0, 7296.0, -13248.0, 8960.0)
gg_rct_curved_1_2_main = Rect(-14912.0, 7808.0, -14400.0, 8320.0)
gg_rct_curved_1_2_mine = Rect(-14912.0, 7296.0, -14400.0, 7808.0)
gg_rct_curved_1_2_spawn = Rect(-12672.0, 5440.0, -11520.0, 7104.0)
gg_rct_curved_1_2_worker = Rect(-14400.0, 7296.0, -13248.0, 8960.0)
gg_rct_curved_1_3_build = Rect(-14400.0, 5440.0, -13248.0, 7104.0)
gg_rct_curved_1_3_main = Rect(-14912.0, 5952.0, -14400.0, 6464.0)
gg_rct_curved_1_3_mine = Rect(-14912.0, 5440.0, -14400.0, 5952.0)
gg_rct_curved_1_3_spawn = Rect(-12672.0, 5440.0, -11520.0, 7104.0)
gg_rct_curved_1_3_worker = Rect(-14400.0, 5440.0, -13248.0, 7104.0)
gg_rct_curved_1_4_build = Rect(-14400.0, 3584.0, -13248.0, 5248.0)
gg_rct_curved_1_4_main = Rect(-14912.0, 4096.0, -14400.0, 4608.0)
gg_rct_curved_1_4_mine = Rect(-14912.0, 3584.0, -14400.0, 4096.0)
gg_rct_curved_1_4_spawn = Rect(-12672.0, 5440.0, -11520.0, 7104.0)
gg_rct_curved_1_4_worker = Rect(-14400.0, 3584.0, -13248.0, 5248.0)
gg_rct_curved_1_5_build = Rect(-14400.0, 1728.0, -13248.0, 3392.0)
gg_rct_curved_1_5_main = Rect(-14912.0, 2240.0, -14400.0, 2752.0)
gg_rct_curved_1_5_mine = Rect(-14912.0, 1728.0, -14400.0, 2240.0)
gg_rct_curved_1_5_spawn = Rect(-12672.0, 5440.0, -11520.0, 7104.0)
gg_rct_curved_1_5_worker = Rect(-14400.0, 1728.0, -13248.0, 3392.0)
gg_rct_curved_2_1_build = Rect(-768.0, 9152.0, 384.0, 10816.0)
gg_rct_curved_2_1_main = Rect(384.0, 9664.0, 896.0, 10176.0)
gg_rct_curved_2_1_mine = Rect(384.0, 9152.0, 896.0, 9664.0)
gg_rct_curved_2_1_spawn = Rect(-2496.0, 5440.0, -1344.0, 7104.0)
gg_rct_curved_2_1_worker = Rect(-768.0, 9152.0, 384.0, 10816.0)
gg_rct_curved_2_2_build = Rect(-768.0, 7296.0, 384.0, 8960.0)
gg_rct_curved_2_2_main = Rect(384.0, 7808.0, 896.0, 8320.0)
gg_rct_curved_2_2_mine = Rect(384.0, 7296.0, 896.0, 7808.0)
gg_rct_curved_2_2_spawn = Rect(-2496.0, 5440.0, -1344.0, 7104.0)
gg_rct_curved_2_2_worker = Rect(-768.0, 7296.0, 384.0, 8960.0)
gg_rct_curved_2_3_build = Rect(-768.0, 5440.0, 384.0, 7104.0)
gg_rct_curved_2_3_main = Rect(384.0, 5952.0, 896.0, 6464.0)
gg_rct_curved_2_3_mine = Rect(384.0, 5440.0, 896.0, 5952.0)
gg_rct_curved_2_3_spawn = Rect(-2496.0, 5440.0, -1344.0, 7104.0)
gg_rct_curved_2_3_worker = Rect(-768.0, 5440.0, 384.0, 7104.0)
gg_rct_curved_2_4_build = Rect(-768.0, 3584.0, 384.0, 5248.0)
gg_rct_curved_2_4_main = Rect(384.0, 4096.0, 896.0, 4608.0)
gg_rct_curved_2_4_mine = Rect(384.0, 3584.0, 896.0, 4096.0)
gg_rct_curved_2_4_spawn = Rect(-2496.0, 5440.0, -1344.0, 7104.0)
gg_rct_curved_2_4_worker = Rect(-768.0, 3584.0, 384.0, 5248.0)
gg_rct_curved_2_5_build = Rect(-768.0, 1728.0, 384.0, 3392.0)
gg_rct_curved_2_5_main = Rect(384.0, 2240.0, 896.0, 2752.0)
gg_rct_curved_2_5_mine = Rect(384.0, 1728.0, 896.0, 2240.0)
gg_rct_curved_2_5_spawn = Rect(-2496.0, 5440.0, -1344.0, 7104.0)
gg_rct_curved_2_5_worker = Rect(-768.0, 1728.0, 384.0, 3392.0)
gg_rct_curved_team_1_base = Rect(-11488.0, 5952.0, -10880.0, 6592.0)
gg_rct_curved_team_1_tower = Rect(-9536.0, 6016.0, -9024.0, 6528.0)
gg_rct_curved_team_2_base = Rect(-3104.0, 5952.0, -2496.0, 6592.0)
gg_rct_curved_team_2_tower = Rect(-4928.0, 6016.0, -4416.0, 6528.0)
gg_rct_curved_1_1_laboratory = Rect(-14912.0, 10176.0, -14400.0, 10688.0)
gg_rct_curved_1_2_laboratory = Rect(-14912.0, 8320.0, -14400.0, 8832.0)
gg_rct_curved_1_3_laboratory = Rect(-14912.0, 6464.0, -14400.0, 6976.0)
gg_rct_curved_1_4_laboratory = Rect(-14912.0, 4608.0, -14400.0, 5120.0)
gg_rct_curved_1_5_laboratory = Rect(-14912.0, 2752.0, -14400.0, 3264.0)
gg_rct_curved_2_1_laboratory = Rect(384.0, 10176.0, 896.0, 10688.0)
gg_rct_curved_2_2_laboratory = Rect(384.0, 8320.0, 896.0, 8832.0)
gg_rct_curved_2_3_laboratory = Rect(384.0, 6464.0, 896.0, 6976.0)
gg_rct_curved_2_4_laboratory = Rect(384.0, 4608.0, 896.0, 5120.0)
gg_rct_curved_2_5_laboratory = Rect(384.0, 2752.0, 896.0, 3264.0)
gg_rct_curved_team_2_attack_1_left = Rect(-11552.0, 3552.0, -1344.0, 8992.0)
gg_rct_curved_1_1_shop = Rect(-15424.0, 9664.0, -14912.0, 10176.0)
gg_rct_curved_1_2_shop = Rect(-15424.0, 7808.0, -14912.0, 8320.0)
gg_rct_curved_1_3_shop = Rect(-15424.0, 5952.0, -14912.0, 6464.0)
gg_rct_curved_1_4_shop = Rect(-15424.0, 4096.0, -14912.0, 4608.0)
gg_rct_curved_1_5_shop = Rect(-15424.0, 2240.0, -14912.0, 2752.0)
gg_rct_curved_2_1_shop = Rect(896.0, 9664.0, 1408.0, 10176.0)
gg_rct_curved_2_2_shop = Rect(896.0, 7808.0, 1408.0, 8320.0)
gg_rct_curved_2_3_shop = Rect(896.0, 5952.0, 1408.0, 6464.0)
gg_rct_curved_2_4_shop = Rect(896.0, 4096.0, 1408.0, 4608.0)
gg_rct_curved_2_5_shop = Rect(896.0, 2240.0, 1408.0, 2752.0)
gg_rct_curved_1_1_image = Rect(-10848.0, 6688.0, -10624.0, 6912.0)
gg_rct_curved_1_2_image = Rect(-10848.0, 6432.0, -10624.0, 6656.0)
gg_rct_curved_1_3_image = Rect(-10848.0, 6176.0, -10624.0, 6400.0)
gg_rct_curved_1_4_image = Rect(-10848.0, 5920.0, -10624.0, 6144.0)
gg_rct_curved_1_5_image = Rect(-10848.0, 5664.0, -10624.0, 5888.0)
gg_rct_curved_2_1_image = Rect(-3456.0, 6656.0, -3232.0, 6880.0)
gg_rct_curved_2_2_image = Rect(-3456.0, 6400.0, -3232.0, 6624.0)
gg_rct_curved_2_3_image = Rect(-3456.0, 6144.0, -3232.0, 6368.0)
gg_rct_curved_2_4_image = Rect(-3456.0, 5888.0, -3232.0, 6112.0)
gg_rct_curved_2_5_image = Rect(-3456.0, 5632.0, -3232.0, 5856.0)
gg_rct_curved_team_1_addGold = Rect(-7008.0, 3552.0, -2464.0, 8992.0)
gg_rct_curved_team_2_addGold = Rect(-11552.0, 3552.0, -7008.0, 8992.0)
end

--CUSTOM_CODE
do
    Debug = {}
    function Debug.beginFile(fileName, depth, lastLine)
    end
    function Debug.endFile(depth)
    end
end
if Debug then Debug.beginFile 'TotalInitialization' end
--[[——————————————————————————————————————————————————————
    Total Initialization version 5.3.1
    Created by: Bribe
    Contributors: Eikonium, HerlySQR, Tasyen, Luashine, Forsakn
    Inspiration: Almia, ScorpioT1000, Troll-Brain
    Hosted at: https://github.com/BribeFromTheHive/Lua/blob/master/TotalInitialization.lua
    Debug library hosted at: https://www.hiveworkshop.com/threads/debug-utils-ingame-console-etc.330758/
————————————————————————————————————————————————————————————]]

---Calls the user's initialization function during the map's loading process. The first argument should either be the init function,
---or it should be the string to give the initializer a name (works similarly to a module name/identically to a vJass library name).
---
---To use requirements, call `Require.strict 'LibraryName'` or `Require.optional 'LibraryName'`. Alternatively, the OnInit callback
---function can take the `Require` table as a single parameter: `OnInit(function(import) import.strict 'ThisIsTheSameAsRequire' end)`.
---
-- - `OnInit.global` or just `OnInit` is called after InitGlobals and is the standard point to initialize.
-- - `OnInit.trig` is called after InitCustomTriggers, and is useful for removing hooks that should only apply to GUI events.
-- - `OnInit.map` is the last point in initialization before the loading screen is completed.
-- - `OnInit.final` occurs immediately after the loading screen has disappeared, and the game has started.
---@class OnInit
--
--Simple Initialization without declaring a library name:
---@overload async fun(initCallback: Initializer.Callback)
--
--Advanced initialization with a library name and an optional third argument to signal to Eikonium's DebugUtils that the file has ended.
---@overload async fun(libraryName: string, initCallback: Initializer.Callback, debugLineNum?: integer)
--
--A way to yield your library to allow other libraries in the same initialization sequence to load, then resume once they have loaded.
---@overload async fun(customInitializerName: string)
OnInit = {}

---@alias Initializer.Callback fun(require?: Requirement | {[string]: Requirement}):...?

---@alias Requirement async fun(reqName: string, source?: table): unknown

-- `Require` will yield the calling `OnInit` initialization function until the requirement (referenced as a string) exists. It will check the
-- global API (for example, does 'GlobalRemap' exist) and then check for any named OnInit resources which might use that same string as its name.
--
-- Due to the way Sumneko's syntax highlighter works, the return value will only be linted for defined @class objects (and doesn't work for regular
-- globals like `TimerStart`). I tried to request the functionality here: https://github.com/sumneko/lua-language-server/issues/1792 , however it
-- was closed. Presumably, there are other requests asking for it, but I wouldn't count on it.
--
-- To declare a requirement, use: `Require.strict 'SomeLibrary'` or (if you don't care about the missing linting functionality) `Require 'SomeLibrary'`
--
-- To optionally require something, use any other suffix (such as `.optionally` or `.nonstrict`): `Require.optional 'SomeLibrary'`
--
---@class Require: { [string]: Requirement }
---@overload async fun(reqName: string, source?: table): string
Require = {}
do
    local library = {} --You can change this to false if you don't use `Require` nor the `OnInit.library` API.

    --CONFIGURABLE LEGACY API FUNCTION:
    ---@param _ENV table
    ---@param OnInit any
    local function assignLegacyAPI(_ENV, OnInit)
        OnGlobalInit = OnInit; OnTrigInit = OnInit.trig; OnMapInit = OnInit.map; OnGameStart = OnInit.final              --Global Initialization Lite API
        --OnMainInit = OnInit.main; OnLibraryInit = OnInit.library; OnGameInit = OnInit.final                            --short-lived experimental API
        --onGlobalInit = OnInit; onTriggerInit = OnInit.trig; onInitialization = OnInit.map; onGameStart = OnInit.final  --original Global Initialization API
        --OnTriggerInit = OnInit.trig; OnInitialization = OnInit.map                                                     --Forsakn's Ordered Indices API
    end
    --END CONFIGURABLES

    local _G, rawget, insert =
    _G, rawget, table.insert

    local initFuncQueue = {}

    ---@param name string
    ---@param continue? function
    local function runInitializers(name, continue)
        --print('running:', name, tostring(initFuncQueue[name]))
        if initFuncQueue[name] then
            for _,func in ipairs(initFuncQueue[name]) do
                coroutine.wrap(func)(Require)
            end
            initFuncQueue[name] = nil
        end
        if library then
            library:resume()
        end
        if continue then
            continue()
        end
    end

    local function initEverything()
        ---@param hookName string
        ---@param continue? function
        local function hook(hookName, continue)
            local hookedFunc = rawget(_G, hookName)
            if hookedFunc then
                rawset(_G, hookName,
                        function()
                            hookedFunc()
                            runInitializers(hookName, continue)
                        end
                )
            else
                runInitializers(hookName, continue)
            end
        end

        hook(
                'InitGlobals',
                function()
                    hook(
                            'InitCustomTriggers',
                            function()
                                hook('RunInitializationTriggers')
                            end
                    )
                end
        )

        hook(
                'MarkGameStarted',
                function()
                    if library then
                        for _,func in ipairs(library.queuedInitializerList) do
                            func(nil, true) --run errors for missing requirements.
                        end
                        for _,func in pairs(library.yieldedModuleMatrix) do
                            func(true) --run errors for modules that aren't required.
                        end
                    end
                    OnInit = nil
                    Require = nil
                end
        )
    end

    ---@param initName       string
    ---@param libraryName    string | Initializer.Callback
    ---@param func?          Initializer.Callback
    ---@param debugLineNum?  integer
    ---@param incDebugLevel? boolean
    local function addUserFunc(initName, libraryName, func, debugLineNum, incDebugLevel)
        if not func then
            ---@cast libraryName Initializer.Callback
            func = libraryName
        else
            assert(type(libraryName) == 'string')
            if debugLineNum and Debug then
                Debug.beginFile(libraryName, incDebugLevel and 3 or 2)
                Debug.data.sourceMap[#Debug.data.sourceMap].lastLine = debugLineNum
            end
            if library then
                func = library:create(libraryName, func)
            end
        end
        assert(type(func) == 'function')

        --print('adding user func: ' , initName , libraryName, debugLineNum, incDebugLevel)

        initFuncQueue[initName] = initFuncQueue[initName] or {}
        insert(initFuncQueue[initName], func)

        if initName == 'root' or initName == 'module' then
            runInitializers(initName)
        end
    end

    ---@param name string
    local function createInit(name)
        ---@async
        ---@param libraryName string                --Assign your callback a unique name, allowing other OnInit callbacks can use it as a requirement.
        ---@param userInitFunc Initializer.Callback --Define a function to be called at the chosen point in the initialization process. It can optionally take the `Require` object as a parameter. Its optional return value(s) are passed to a requiring library via the `Require` object (defaults to `true`).
        ---@param debugLineNum? integer             --If the Debug library is present, you can call Debug.getLine() for this parameter (which should coincide with the last line of your script file). This will neatly tie-in with OnInit's built-in Debug library functionality to define a starting line and an ending line for your module.
        ---@overload async fun(userInitFunc: Initializer.Callback)
        return function(libraryName, userInitFunc, debugLineNum)
            addUserFunc(name, libraryName, userInitFunc, debugLineNum)
        end
    end
    OnInit.global = createInit 'InitGlobals'                -- Called after InitGlobals, and is the standard point to initialize.
    OnInit.trig   = createInit 'InitCustomTriggers'         -- Called after InitCustomTriggers, and is useful for removing hooks that should only apply to GUI events.
    OnInit.map    = createInit 'RunInitializationTriggers'  -- Called last in the script's loading screen sequence. Runs after the GUI "Map Initialization" events have run.
    OnInit.final  = createInit 'MarkGameStarted'            -- Called immediately after the loading screen has disappeared, and the game has started.

    do
        ---@param self table
        ---@param libraryNameOrInitFunc function | string
        ---@param userInitFunc function
        ---@param debugLineNum number
        local function __call(
                self,
                libraryNameOrInitFunc,
                userInitFunc,
                debugLineNum
        )
            if userInitFunc or type(libraryNameOrInitFunc) == 'function' then
                addUserFunc(
                        'InitGlobals', --Calling OnInit directly defaults to OnInit.global (AKA OnGlobalInit)
                        libraryNameOrInitFunc,
                        userInitFunc,
                        debugLineNum,
                        true
                )
            elseif library then
                library:declare(libraryNameOrInitFunc) --API handler for OnInit "Custom initializer"
            else
                error(
                        "Bad OnInit args: "..
                                tostring(libraryNameOrInitFunc) .. ", " ..
                                tostring(userInitFunc)
                )
            end
        end
        setmetatable(OnInit --[[@as table]], { __call = __call })
    end

    do --if you don't need the initializers for 'root', 'config' and 'main', you can delete this do...end block.
        local gmt = getmetatable(_G) or
                getmetatable(setmetatable(_G, {}))

        local rawIndex = gmt.__newindex or rawset

        local hookMainAndConfig
        ---@param _G table
        ---@param key string
        ---@param fnOrDiscard unknown
        function hookMainAndConfig(_G, key, fnOrDiscard)
            if key == 'main' or key == 'config' then
                ---@cast fnOrDiscard function
                if key == 'main' then
                    runInitializers 'root'
                end
                rawIndex(_G, key, function()
                    if key == 'config' then
                        fnOrDiscard()
                    elseif gmt.__newindex == hookMainAndConfig then
                        gmt.__newindex = rawIndex --restore the original __newindex if no further hooks on __newindex exist.
                    end
                    runInitializers(key)
                    if key == 'main' then
                        fnOrDiscard()
                    end
                end)
            else
                rawIndex(_G, key, fnOrDiscard)
            end
        end
        gmt.__newindex = hookMainAndConfig
        OnInit.root    = createInit 'root'   -- Runs immediately during the Lua root, but is yieldable (allowing requirements) and pcalled.
        OnInit.config  = createInit 'config' -- Runs when `config` is called. Credit to @Luashine: https://www.hiveworkshop.com/threads/inject-main-config-from-we-trigger-code-like-jasshelper.338201/
        OnInit.main    = createInit 'main'   -- Runs when `main` is called. Idea from @Tasyen: https://www.hiveworkshop.com/threads/global-initialization.317099/post-3374063
    end
    if library then
        library.queuedInitializerList = {}
        library.customDeclarationList = {}
        library.yieldedModuleMatrix   = {}
        library.moduleValueMatrix     = {}

        function library:pack(name, ...)
            self.moduleValueMatrix[name] = table.pack(...)
        end

        function library:resume()
            if self.queuedInitializerList[1] then
                local continue, tempQueue, forceOptional

                ::initLibraries::
                repeat
                    continue=false
                    self.queuedInitializerList, tempQueue =
                    {}, self.queuedInitializerList

                    for _,func in ipairs(tempQueue) do
                        if func(forceOptional) then
                            continue=true --Something was initialized; therefore further systems might be able to initialize.
                        else
                            insert(self.queuedInitializerList, func) --If the queued initializer returns false, that means its requirement wasn't met, so we re-queue it.
                        end
                    end
                until not continue or not self.queuedInitializerList[1]

                if self.customDeclarationList[1] then
                    self.customDeclarationList, tempQueue =
                    {}, self.customDeclarationList
                    for _,func in ipairs(tempQueue) do
                        func() --unfreeze any custom initializers.
                    end
                elseif not forceOptional then
                    forceOptional = true
                else
                    return
                end
                goto initLibraries
            end
        end
        local function declareName(name, initialValue)
            assert(type(name) == 'string')
            assert(library.moduleValueMatrix[name] == nil)
            library.moduleValueMatrix[name] =
            initialValue and { true, n = 1 }
        end
        function library:create(name, userFunc)
            assert(type(userFunc) == 'function')
            declareName(name, false)                --declare itself as a non-loaded library.
            return function()
                self:pack(name, userFunc(Require))  --pack return values to allow multiple values to be communicated.
                if self.moduleValueMatrix[name].n == 0 then
                    self:pack(name, true)           --No values were returned; therefore simply package the value as `true`
                end
            end
        end

        ---@async
        function library:declare(name)
            declareName(name, true)                 --declare itself as a loaded library.

            local co = coroutine.running()

            insert(
                    self.customDeclarationList,
                    function()
                        coroutine.resume(co)
                    end
            )
            coroutine.yield() --yields the calling function until after all currently-queued initializers have run.
        end

        local processRequirement

        ---@async
        function processRequirement(
                optional,
                requirement,
                explicitSource
        )
            if type(optional) == 'string' then
                optional, requirement, explicitSource =
                true, optional, requirement --optional requirement (processed by the __index method)
            else
                optional = false --strict requirement (processed by the __call method)
            end
            local source = explicitSource or _G

            assert(type(source)=='table')
            assert(type(requirement)=='string')

            ::reindex::
            local subSource, subReq =
            requirement:match("([\x25w_]+)\x25.(.+)") --Check if user is requiring using "table.property" syntax
            if subSource and subReq then
                source,
                requirement =
                processRequirement(subSource, source), --If the container is nil, yield until it is not.
                subReq

                if type(source)=='table' then
                    explicitSource = source
                    goto reindex --check for further nested properties ("table.property.subProperty.anyOthers").
                else
                    return --The source table for the requirement wasn't found, so disregard the rest (this only happens with optional requirements).
                end
            end
            local function loadRequirement(unpack)
                local package = rawget(source, requirement) --check if the requirement exists in the host table.
                if not package and not explicitSource then
                    if library.yieldedModuleMatrix[requirement] then
                        library.yieldedModuleMatrix[requirement]() --load module if it exists
                    end
                    package = library.moduleValueMatrix[requirement] --retrieve the return value from the module.
                    if unpack and type(package)=='table' then
                        return table.unpack(package, 1, package.n) --using unpack allows any number of values to be returned by the required library.
                    end
                end
                return package
            end

            local co, loaded

            local function checkReqs(forceOptional, printErrors)
                if not loaded then
                    loaded = loadRequirement()
                    loaded = loaded or optional and
                            (loaded==nil or forceOptional)
                    if loaded then
                        if co then coroutine.resume(co) end --resume only if it was yielded in the first place.
                        return loaded
                    elseif printErrors then
                        coroutine.resume(co, true)
                    end
                end
            end

            if not checkReqs() then --only yield if the requirement doesn't already exist.
                co = coroutine.running()
                insert(library.queuedInitializerList, checkReqs)
                if coroutine.yield() then
                    error("Missing Requirement: "..requirement) --handle the error within the user's function to get an accurate stack trace via the `try` function.
                end
            end

            return loadRequirement(true)
        end

        ---@type Requirement
        function Require.strict(name, explicitSource)
            return processRequirement(nil, name, explicitSource)
        end

        setmetatable(Require --[[@as table]], {
            __call = processRequirement,
            __index = function()
                return processRequirement
            end
        })

        local module  = createInit 'module'

        --- `OnInit.module` will only call the OnInit function if the module is required by another resource, rather than being called at a pre-
        --- specified point in the loading process. It works similarly to Go, in that including modules in your map that are not actually being
        --- required will throw an error message.
        ---@param name          string
        ---@param func          fun(require?: Initializer.Callback):any
        ---@param debugLineNum? integer
        OnInit.module = function(name, func, debugLineNum)
            if func then
                local userFunc = func
                func = function(require)
                    local co = coroutine.running()

                    library.yieldedModuleMatrix[name] =
                    function(failure)
                        library.yieldedModuleMatrix[name] = nil
                        coroutine.resume(co, failure)
                    end

                    if coroutine.yield() then
                        error("Module declared but not required: "..name)
                    end

                    return userFunc(require)
                end
            end
            module(name, func, debugLineNum)
        end
    end

    if assignLegacyAPI then --This block handles legacy code.
        ---Allows packaging multiple requirements into one table and queues the initialization for later.
        ---@deprecated
        ---@param initList string | table
        ---@param userFunc function
        function OnInit.library(initList, userFunc)
            local typeOf = type(initList)

            assert(typeOf=='table' or typeOf=='string')
            assert(type(userFunc) == 'function')

            local function caller(use)
                if typeOf=='string' then
                    use(initList)
                else
                    for _,initName in ipairs(initList) do
                        use(initName)
                    end
                    if initList.optional then
                        for _,initName in ipairs(initList.optional) do
                            use.lazily(initName)
                        end
                    end
                end
            end
            if initList.name then
                OnInit(initList.name, caller)
            else
                OnInit(caller)
            end
        end

        local legacyTable = {}

        assignLegacyAPI(legacyTable, OnInit)

        for key,func in pairs(legacyTable) do
            rawset(_G, key, func)
        end

        OnInit.final(function()
            for key in pairs(legacyTable) do
                rawset(_G, key, nil)
            end
        end)
    end

    initEverything()
end
if Debug then Debug.endFile() end
Debug.beginFile('common.lua')
function calculateDif(buidRect, spawnRect, unit)

    local buidRectX = GetRectCenterX(buidRect)
    local buidRectY = GetRectCenterY(buidRect)

    local spawnRectX = GetRectCenterX(spawnRect)
    local spawnRectY = GetRectCenterY(spawnRect)

    local unitX = GetUnitX(unit)
    local unitY = GetUnitY(unit)
    return spawnRectX - (buidRectX - unitX), spawnRectY - (buidRectY - unitY)
end
Debug.endFile()
Debug.beginFile('game-config.lua')
function initGameConfig()
    game_config = {
        economy = {
            startGold = nil,
            startIncomePerSec = nil,
            incomeBoost = nil,
            firstMinePrice = nil,
            nextMineDiffPrice = nil,
            goldByTower = nil,
            incomeForCenter = nil,
            goldForKill = nil,
            upkeep = nil
        },
        units = {
            range = 1,
            lifetime = nil,
            isUnitsMirror = nil,
            isHeroesMirror = nil,
            maxHeroes = nil,
            itemCapacity = nil,
            baseHP = nil,
            towerHP = nil,
            countForSelect = nil,
            heroCost = 500,
            heroStartLevel = nil
        },
        spawnPolicy = {
            interval = nil,
            dif = nil
        },
        playerPosition = { 1, 2, 3, 4, 5 },
        isOpenAllMap = false,
        playersCount = getPlayersCount()
    }

    local count = 0
    for i = 0, 9 do
        if (GetPlayerSlotState(Player(i)) == PLAYER_SLOT_STATE_PLAYING) then
            count = count + 1
        end
    end

end

function getPlayersCount()
    local count = 0
    for i = 0, 9 do
        if (GetPlayerSlotState(Player(i)) == PLAYER_SLOT_STATE_PLAYING) then
            count = count + 1
        end
    end
    return count
end

function initGlobalVariables()
    players_team_left = {
        { id = Player(0), spawnId = Player(17), team = 1 },
        { id = Player(2), spawnId = Player(18), team = 1 },
        { id = Player(3), spawnId = Player(16), team = 1 },
        { id = Player(4), spawnId = Player(19), team = 1 },
        { id = Player(5), spawnId = Player(15), team = 1 }
    }
    players_team_right = {
        { id = Player(1), spawnId = Player(12), team = 2 },
        { id = Player(6), spawnId = Player(13), team = 2 },
        { id = Player(7), spawnId = Player(11), team = 2 },
        { id = Player(8), spawnId = Player(14), team = 2 },
        { id = Player(9), spawnId = Player(10), team = 2 }
    }
    heroes_for_build = {
        { id = 'H011', parentId = 'Hpal', race = 'human', line = 1, position = 1, name = 'Paladin', abilities = { { id = 'AHhb' }, { id = 'AHds' }, { id = 'AHre' }, { id = 'AHad' } } },
        { id = 'H01A', parentId = 'Hamg', race = 'human', line = 1, position = 2, name = 'Archmage', abilities = { { id = 'AHbz' }, { id = 'AHab' }, { id = 'AHwe' }, { id = 'ANto' } } },
        { id = 'H01B', parentId = 'Hmkg', race = 'human', line = 1, position = 3, name = 'Mountain King', abilities = { { id = 'AHtc' }, { id = 'AHtb' }, { id = 'AHbn' }, { id = 'AHav' } } },
        { id = 'H01C', parentId = 'Hblm', race = 'human', line = 1, position = 4, name = 'Blood Mage', abilities = { { id = 'AHfc' }, { id = 'AHbn' }, { id = 'AHdr' }, { id = 'AHpx' } } },

        { id = 'O00E', parentId = 'Obla', race = 'orc', line = 2, position = 1, name = 'Blademaster', abilities = { { id = 'AOwk' }, { id = 'AOcr' }, { id = 'AOmi' }, { id = 'AOww' } } },
        { id = 'O00F', parentId = 'Ofar', race = 'orc', line = 2, position = 2, name = 'Far Seer', abilities = { { id = 'AOfs' }, { id = 'AOsf' }, { id = 'AOcl' }, { id = 'AOeq' } } },
        { id = 'O00G', parentId = 'Otch', race = 'orc', line = 2, position = 3, name = 'Tauren Chieftain', abilities = { { id = 'AOsh' }, { id = 'AOae' }, { id = 'AOre' }, { id = 'AOws' } } },
        { id = 'O00H', parentId = 'Oshd', race = 'orc', line = 2, position = 4, name = 'Shadow Hunter', abilities = { { id = 'AOhw' }, { id = 'AOhx' }, { id = 'AOsw' }, { id = 'AOvd' } } },

        { id = 'U00B', parentId = 'Udea', race = 'undead', line = 3, position = 1, name = 'Death Knight', abilities = { { id = 'AUdc' }, { id = 'AUdp' }, { id = 'AUau' }, { id = 'AUan' } } },
        { id = 'U00C', parentId = 'Ulic', race = 'undead', line = 3, position = 2, name = 'Lich', abilities = { { id = 'AUfn' }, { id = 'AUfu' }, { id = 'AUdr' }, { id = 'AUdd' } } },
        { id = 'U00D', parentId = 'Udre', race = 'undead', line = 3, position = 3, name = 'Dreadlord', abilities = { { id = 'AUav' }, { id = 'AUcs' }, { id = 'AUin' }, { id = 'A001' } } },
        { id = 'U00E', parentId = 'Ucrl', race = 'undead', line = 3, position = 4, name = 'Crypt Lord', abilities = { { id = 'AUim' }, { id = 'AUts' }, { id = 'AUcb' }, { id = 'AUls' } } },

        { id = 'E00N', parentId = 'Ekee', race = 'elf', line = 4, position = 1, name = 'Keeper of the Grove', abilities = { { id = 'AEer' }, { id = 'AEah' }, { id = 'A002' }, { id = 'AEtq' } } },
        { id = 'E00O', parentId = 'Emoo', race = 'elf', line = 4, position = 2, name = 'Priestess of the Moon', abilities = { { id = 'AHfa' }, { id = 'ANsi' }, { id = 'AEar' }, { id = 'AEsf' } } },
        { id = 'E00P', parentId = 'Edem', race = 'elf', line = 4, position = 3, name = 'Demon Hunter', abilities = { { id = 'AEmb' }, { id = 'AEim' }, { id = 'AEev' }, { id = 'AEme' } }, otherForm = {'Edmm'} },
        { id = 'E00Q', parentId = 'Ewar', race = 'elf', line = 4, position = 4, name = 'Warden', abilities = { { id = 'AEbl' }, { id = 'AEfk' }, { id = 'AEsh' }, { id = 'AEsv' } } },

        { id = 'N000', parentId = 'Nalc', race = 'other', line = 5, position = 1, name = 'Alchemist', abilities = { { id = 'ANhs' }, { id = 'ANab' }, { id = 'ANcr' }, { id = 'ANtm' } }, otherForm = {'Nalm', 'Nal2', 'Nal3'}},
        { id = 'N001', parentId = 'Nngs', race = 'other', line = 5, position = 2, name = 'Sea Witch', abilities = { { id = 'ANfl' }, { id = 'ANfa' }, { id = 'ANms' }, { id = 'ANto' } } },
        { id = 'N002', parentId = 'Ntin', race = 'other', line = 5, position = 3, name = 'Tinker', abilities = { { id = 'ANsy' }, { id = 'ANcs' }, { id = 'ANeg' }, { id = 'ANrg' } }, otherForm = {'Nrob'} },
        { id = 'N003', parentId = 'Nbst', race = 'other', line = 5, position = 4, name = 'Beastmaster', abilities = { { id = 'ANsg' }, { id = 'ANsq' }, { id = 'ANsw' }, { id = 'ANst' } } },
        { id = 'N004', parentId = 'Npbm', race = 'other', line = 5, position = 5, name = 'Brewmaster', abilities = { { id = 'ANbf' }, { id = 'ANdh' }, { id = 'ANdb' }, { id = 'ANef' } } },
        { id = 'N005', parentId = 'Nbrn', race = 'other', line = 5, position = 6, name = 'Dark Ranger', abilities = { { id = 'ANse' }, { id = 'ANba' }, { id = 'ANdr' }, { id = 'ANch' } } },
        { id = 'N006', parentId = 'Nfir', race = 'other', line = 5, position = 7, name = 'Firelord', abilities = { { id = 'ANic' }, { id = 'ANso' }, { id = 'ANlm' }, { id = 'ANvc' } } },
        { id = 'N007', parentId = 'Nplh', race = 'other', line = 5, position = 8, name = 'Pit Lord', abilities = { { id = 'ANrf' }, { id = 'ANht' }, { id = 'ANca' }, { id = 'ANdo' } } }
    }
    units_for_build = {
        { id = 'h00C', parentId = 'h00A', tier = 1, race = 'human', line = 1, position = 1, food = 2, name = 'Footman', upgrades = { 'Rhde' }, abilities = { { id = 'Adef' } } },
        { id = 'h004', parentId = 'h00D', tier = 1, race = 'human', line = 1, position = 2, food = 3, name = 'Rifleman', upgrades = { 'Rhri' } },
        { id = 'h008', parentId = 'h00I', tier = 1, race = 'human', line = 1, position = 3, food = 2, name = 'Sorceress', upgrades = { 'Rhst' }, abilities = { { id = 'Aply' }, { id = 'Aivs' }, { id = 'Aslo' } } },
        { id = 'h003', parentId = 'h00E', tier = 2, race = 'human', line = 1, position = 4, food = 3, name = 'Mortar Team', upgrades = { 'Rhfl', 'Rhfs' } },
        { id = 'h007', parentId = 'h00H', tier = 2, race = 'human', line = 1, position = 5, food = 2, name = 'Priest', upgrades = { 'Rhpt' }, abilities = { { id = 'Ahea' }, { id = 'Ainf' }, { id = 'Adis' } } },
        { id = 'h006', parentId = 'h00K', tier = 2, race = 'human', line = 1, position = 6, food = 3, name = 'Spellbreaker', upgrades = { 'Rhss' } },
        { id = 'h000', parentId = 'h00F', tier = 2, race = 'human', line = 1, position = 7, food = 1, name = 'Flying Machine', upgrades = { 'Rhgb', 'Rhfc' } },
        { id = 'h009', parentId = 'h00L', tier = 3, race = 'human', line = 1, position = 8, food = 3, name = 'Dragonhawk Rider', upgrades = { 'Rhan' } },
        { id = 'h002', parentId = 'h00B', tier = 3, race = 'human', line = 1, position = 9, food = 4, name = 'Knight', upgrades = { 'Rhan' } },
        { id = 'h005', parentId = 'h00J', tier = 3, race = 'human', line = 1, position = 10, food = 3, name = 'Siege Engine', upgrades = { 'Rhrt' }, otherForm = {'hrtt'} },
        { id = 'h001', parentId = 'h00G', tier = 2, race = 'human', line = 1, position = 11, food = 4, name = 'Gryphon Rider', upgrades = { 'Rhhb', 'Rhan' } },

        { id = 'h00P', parentId = 'o003', tier = 1, race = 'orc', line = 2, position = 1, food = 3, name = 'Grunt', upgrades = { 'Robs' } },
        { id = 'h00Q', parentId = 'o006', tier = 1, race = 'orc', line = 2, position = 2, food = 2, name = 'Headhunter', upgrades = { 'Robk', 'Rotr' }, otherForm = {'otbk'} },
        { id = 'h00T', parentId = 'o00C', tier = 1, race = 'orc', line = 2, position = 3, food = 2, name = 'Shaman', upgrades = { 'Rost' }, abilities = { { id = 'Ablo' }, { id = 'Alsh' }, { id = 'Aprg' } } },
        { id = 'h00S', parentId = 'o004', tier = 2, race = 'orc', line = 2, position = 4, food = 3, name = 'Raider', upgrades = { 'Roen', 'Ropg' }, abilities = { { id = 'Aens' } } },
        { id = 'h00X', parentId = 'o00B', tier = 2, race = 'orc', line = 2, position = 5, food = 2, name = 'Witch Doctor', upgrades = { 'Rowd', 'Rotr' }, abilities = { { id = 'Aeye' }, { id = 'Ahwd' }, { id = 'Asta' } } },
        { id = 'h00U', parentId = 'o00D', tier = 2, race = 'orc', line = 2, position = 6, food = 3, name = 'Spirit Walker', upgrades = { 'Rowt' }, abilities = { { id = 'Aspl' }, { id = 'Adcn' }, { id = 'Aast' } }, otherForm = {'ospm'} },
        { id = 'h00N', parentId = 'o00A', tier = 2, race = 'orc', line = 2, position = 7, food = 2, name = 'Batrider', upgrades = { 'Rotr' } },
        { id = 'h00R', parentId = 'o008', tier = 2, race = 'orc', line = 2, position = 8, food = 4, name = 'Kodo Beast', upgrades = { 'Rwdm' } },
        { id = 'h00V', parentId = 'o005', tier = 3, race = 'orc', line = 2, position = 9, food = 5, name = 'Tauren', upgrades = { 'Rows' } },
        { id = 'h00O', parentId = 'o007', tier = 3, race = 'orc', line = 2, position = 10, food = 4, name = 'Demolisher', upgrades = { 'Robf' } },
        { id = 'h00W', parentId = 'o009', tier = 3, race = 'orc', line = 2, position = 11, food = 4, name = 'Wind Rider', upgrades = { 'Rovs' } },

        { id = 'h014', parentId = 'u001', tier = 1, race = 'undead', line = 3, position = 1, food = 2, name = 'Ghoul', upgrades = { 'Rugf' } },
        { id = 'h010', parentId = 'u004', tier = 1, race = 'undead', line = 3, position = 2, food = 3, name = 'Crypt Fiend', upgrades = { 'Ruwb', 'Rubu' }, abilities = { { id = 'Aweb' }, { id = 'Abur' } }, otherForm = {'ucrm'} },
        { id = 'h00Z', parentId = 'u006', tier = 1, race = 'undead', line = 3, position = 3, food = 2, name = 'Banshee', upgrades = { 'Ruba' }, abilities = { { id = 'Aams' }, { id = 'Acrs' }, { id = 'Aps2' } } },
        { id = 'h017', parentId = 'u008', tier = 2, race = 'undead', line = 3, position = 4, food = 3, name = 'Obsidian Statue', upgrades = {}, abilities = { { id = 'Arpl' }, { id = 'Arpm' } } },
        { id = 'h013', parentId = 'u005', tier = 2, race = 'undead', line = 3, position = 5, food = 2, name = 'Gargoyle', upgrades = { 'Rusf' }, abilities = { { id = 'Astn' }, { id = 'Aatp' } }, otherForm = {'ugrm'} },
        { id = 'h016', parentId = 'u007', tier = 2, race = 'undead', line = 3, position = 6, food = 2, name = 'Necromancer', upgrades = { 'Rusl', 'Rune', 'Rusm' }, abilities = { { id = 'Acri' }, { id = 'Arai' }, { id = 'Auhf' } } },
        { id = 'h015', parentId = 'u003', tier = 2, race = 'undead', line = 3, position = 7, food = 4, name = 'Meat Wagon', upgrades = { 'Rupc' } },
        { id = 'h018', parentId = 'u000', tier = 2, race = 'undead', line = 3, position = 8, food = 1, name = 'Shade', upgrades = {} },
        { id = 'h00Y', parentId = 'u002', tier = 3, race = 'undead', line = 3, position = 9, food = 4, name = 'Abomination', upgrades = { 'Rupc' } },
        { id = 'h019', parentId = 'u00A', tier = 3, race = 'undead', line = 3, position = 10, food = 4, name = 'Destroyer', upgrades = {} },
        { id = 'h012', parentId = 'u009', tier = 3, race = 'undead', line = 3, position = 11, food = 7, name = 'Frost Wyrm', upgrades = { 'Rufb' } },

        { id = 'e009', parentId = 'e00C', tier = 1, race = 'elf', line = 4, position = 1, food = 3, name = 'Huntress', upgrades = { 'Remg', 'Resc' } },
        { id = 'e000', parentId = 'e00B', tier = 1, race = 'elf', line = 4, position = 2, food = 2, name = 'Archer', upgrades = { 'Reib', 'Remk' } },
        { id = 'e004', parentId = 'e00D', tier = 1, race = 'elf', line = 4, position = 3, food = 3, name = 'Dryad', upgrades = { 'Resi' } },
        { id = 'e006', parentId = 'e00E', tier = 2, race = 'elf', line = 4, position = 4, food = 3, name = 'Glaive Thower', upgrades = {} },
        { id = 'e007', parentId = 'e00F', tier = 2, race = 'elf', line = 4, position = 5, food = 2, name = 'Hippogryph', upgrades = {} },
        { id = 'e002', parentId = 'e00J', tier = 2, race = 'elf', line = 4, position = 6, food = 4, name = 'Druid of the Claw', upgrades = { 'Redc' }, abilities = { { id = 'Abrf' }, { id = 'Arej' }, { id = 'Aroa' } }, otherForm = {'edcm'} },
        { id = 'e003', parentId = 'e00I', tier = 2, race = 'elf', line = 4, position = 7, food = 2, name = 'Druid of the Talon', upgrades = { 'Redt' }, abilities = { { id = 'Acyc' }, { id = 'Arav' }, { id = 'Afae' } }, otherForm = {'edtm'} },
        { id = 'e005', parentId = 'e00L', tier = 2, race = 'elf', line = 4, position = 8, food = 2, name = 'Faerie Dragon', upgrades = {}, abilities = { { id = 'Amfl' } } },
        { id = 'e00A', parentId = 'e00K', tier = 3, race = 'elf', line = 4, position = 9, food = 7, name = 'Mountain Giant', upgrades = { 'Rers', 'Rehs' }, abilities = { { id = 'Atau' } } },
        { id = 'e008', parentId = 'e00G', tier = 3, race = 'elf', line = 4, position = 10, food = 4, name = 'Hippogryph Rider', upgrades = {} },
        { id = 'e001', parentId = 'e00H', tier = 3, race = 'elf', line = 4, position = 11, food = 5, name = 'Chimaera', upgrades = { 'Recb' } },
    }
    units_special = {
        builder = 'u00F',
        tower = 'o001',
        base = 'o002',
        mine = 'ugol',
        main = 'htow',
        laboratory = 'nmgv',
        shop = 'ngme',
        heroBuilder = 'e00M',
        randomHero = 'ncop',
        t2 = 'hkee',
        t3 = 'hcas'
    }
    abilities = {
        mine = 'A000',
        sell100 = 'A003',
        sell75 = 'A004',
        moveLarge = 'A007',
        moveMedium = 'A006',
        moveSmall = 'A005',
        inventory = {
            [1] = 'A00F',
            [2] = 'A00E',
            [3] = 'A00D',
            [4] = 'A00C',
            [5] = 'A00B',
            [6] = 'AInv',
        }
    }

    upgrades_special = {
        summonHeroBuilder = 'R000'
    }

    main_race = {
        { id = 'hcas', race = 'human' },
        { id = 'ofrt', race = 'orc' },
        { id = 'unp2', race = 'undead' },
        { id = 'etoe', race = 'elf' },
        { id = 'ntav', race = 'other' }
    }
end
Debug.endFile()
Debug.beginFile('game-init.lua')
function initGame()
    UseTimeOfDayBJ(false)
    SetTimeOfDay(12)
    initTeams()
    initRect()

    setEnemyBetweenPlayers()
    setAllianceBetweenSpawnPlayers()
    setAllianceBetweenPlayers()
    setAllianceBetweenPlayersAndSpawnPlayers()
    changeColorAndNameSpawnPlayers()
    changeAvailableUnitsForPlayers()
    initCamera()

    createBaseAndTower()
    addWorkers()
    createBuildingsForPlayers()
    createPictures()
    initPanelForAllPlayers()
    initAbilitiesPanel()
    heroStatisticPanel()
end

function createPictures()
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do

            if type(player.imageRect) == 'table' then
                for _, image in ipairs(player.imageRect) do
                    local name = GetPlayerName(player.id)
                    local image = CreateImageBJ("playerImg\\" .. name, 256, GetRectCenter(image), 0, 2)
                    SetImageRenderAlways(image, true)
                    ShowImageBJ(true, image)
                end

            else
                local name = GetPlayerName(player.id)
                local image = CreateImageBJ("playerImg\\" .. name, 256, GetRectCenter(player.imageRect), 0, 2)
                SetImageRenderAlways(image, true)
                ShowImageBJ(true, image)
            end
        end
    end
end

function initTeams()
    all_teams = {}

    all_teams[1] = {
        i = 1,
        players = addPlayersInTeam(players_team_left),
        base = {
            player = Player(17),
            winTeam = 2,
            baseRect = nil,
            towerRect = nil
        }
    }
    all_teams[2] = {
        i = 2,
        players = addPlayersInTeam(players_team_right),
        base = {
            player = Player(12),
            winTeam = 1,
            baseRect = nil,
            towerRect = nil
        }
    }
    all_teams[1].base.player = Player(20)
    all_teams[2].base.player = Player(21)
end

function getCountPlayers()
    local countActivePlayer = 0
    for _, player in ipairs(mergeSequences(players_team_left, players_team_right)) do
        if (GetPlayerSlotState(player.id) == PLAYER_SLOT_STATE_PLAYING) then
            countActivePlayer = countActivePlayer + 1
        end
    end
    return countActivePlayer
end

function mergeSequences(t1, t2)
    local result = {}
    for i = 1, #t1 do
        result[i] = t1[i]
    end
    for i = 1, #t2 do
        result[#t1 + i] = t2[i]
    end
    return result
end

function getMainPlayer()
    for _, player in ipairs(players_team_left) do
        if (GetPlayerSlotState(player.id) == PLAYER_SLOT_STATE_PLAYING) then
            return player.id
        end
    end
    for _, player in ipairs(players_team_right) do
        if (GetPlayerSlotState(player.id) == PLAYER_SLOT_STATE_PLAYING) then
            return player.id
        end
    end
end

function addPlayersInTeam(players)
    local nextPosition = 1
    local initialPlayers = {}
    for _, player in ipairs(players) do
        if (GetPlayerSlotState(player.id) == PLAYER_SLOT_STATE_PLAYING) then
            table.insert(initialPlayers, {
                id = player.id,
                color = getColorById(GetPlayerId(player.id)),
                integerColor = getIntegerColorById(GetPlayerId(player.id)),
                spawnPlayerId = player.spawnId,
                i = game_config.playerPosition[nextPosition],
                economy = {
                    income = game_config.economy.startIncomePerSec,
                    incomeForCenter = 0,
                    minePrice = game_config.economy.firstMinePrice,
                    mineLevel = 0,
                    mineTextTag = nil,
                    totalGold = game_config.economy.startGold,
                    totalGoldForKills = 0,
                    roundUp = false
                },
                buildRect = nil,
                workerRect = nil,
                mineRect = nil,
                mainRect = nil,
                laboratoryRect = nil,
                attackPointRect = {},
                spawnRect = nil,
                shopRect = nil,
                spawnTimer = game_config.playerPosition[nextPosition] * game_config.spawnPolicy.interval + game_config.spawnPolicy.dif,
                heroes = {},
                totalDamage = 0,
                totalKills = 0,
                availableUnits = {},
                availableHeroes = {},
                tier = 'T1',
                food = 0,
                waveNumber = 0,
                heroBuilderCount = 0
            })
            nextPosition = nextPosition + 1
        end
    end
    return initialPlayers
end

function getColorById(playerId)
    if (playerId == 0) then
        return { r = 255, g = 2, b = 2, t = 255 }
    end
    if (playerId == 1) then
        return { r = 0, g = 65, b = 255, t = 255 }
    end
    if (playerId == 2) then
        return { r = 27, g = 229, b = 184, t = 255 }
    end
    if (playerId == 3) then
        return { r = 83, g = 0, b = 128, t = 255 }
    end
    if (playerId == 4) then
        return { r = 255, g = 255, b = 0, t = 255 }
    end
    if (playerId == 5) then
        return { r = 254, g = 137, b = 13, t = 255 }
    end
    if (playerId == 6) then
        return { r = 31, g = 191, b = 0, t = 255 }
    end
    if (playerId == 7) then
        return { r = 228, g = 90, b = 170, t = 255 }
    end
    if (playerId == 8) then
        return { r = 148, g = 149, b = 150, t = 255 }
    end
    if (playerId == 9) then
        return { r = 125, g = 190, b = 241, t = 255 }
    end
end

function getIntegerColorById(playerId)
    if (playerId == 0) then
        return BlzConvertColor(255, 255, 2, 2)
    end
    if (playerId == 1) then
        return BlzConvertColor(255, 0, 65, 255)
    end
    if (playerId == 2) then
        return BlzConvertColor(255, 27, 229, 184)
    end
    if (playerId == 3) then
        return BlzConvertColor(255, 83, 0, 128)
    end
    if (playerId == 4) then
        return BlzConvertColor(255, 255, 255, 0)
    end
    if (playerId == 5) then
        return BlzConvertColor(255, 254, 137, 13)
    end
    if (playerId == 6) then
        return BlzConvertColor(255, 31, 191, 0)
    end
    if (playerId == 7) then
        return BlzConvertColor(255, 228, 90, 170)
    end
    if (playerId == 8) then
        return BlzConvertColor(255, 148, 149, 150)
    end
    if (playerId == 9) then
        return BlzConvertColor(255, 125, 190, 241)
    end
end

function initRect()
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            player.buildRect = regions['curved'][team.i][player.i]['build']
            player.workerRect = regions['curved'][team.i][player.i]['worker']
            player.mineRect = regions['curved'][team.i][player.i]['mine']
            player.mainRect = regions['curved'][team.i][player.i]['main']
            player.laboratoryRect = regions['curved'][team.i][player.i]['laboratory']
            player.spawnRect = regions['curved'][team.i][player.i]['spawn']
            player.shopRect = regions['curved'][team.i][player.i]['shop']
            player.imageRect = regions['curved'][team.i][player.i]['image']
        end
        team.base.baseRect = regions['curved']['team'][team.i]['base']
        team.base.towerRect = regions['curved']['team'][team.i]['tower']
        team.base.addGoldRect = regions['curved']['team'][team.i]['addGold']
    end

    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            local attackData = regions['curved'][team.i][player.i]['attack']
            if not attackData then
                attackData = regions['curved']['team'][team.i]['attack']
            end
            if not attackData then
                attackData = regions['curved']['global']['attack']
            end

            local directions = { 'right', 'left', 'up', 'down' }
            for i, data in ipairs(attackData) do
                for _, dir in ipairs(directions) do
                    if data[dir] then
                        player.attackPointRect[i] = { rect = data[dir], direction = dir }
                        break
                    end
                end
            end
        end
    end
end

function createBaseAndTower()
    for _, team in ipairs(all_teams) do
        local base = CreateUnit(
                team.base.player,
                FourCC(units_special.base),
                GetRectCenterX(team.base.baseRect),
                GetRectCenterY(team.base.baseRect),
                0
        )
        BlzSetUnitMaxHP(base, game_config.units.baseHP)
        SetUnitLifeBJ(base, game_config.units.baseHP)

        if team.base.towerRect ~= nil then
            local tower = CreateUnit(
                    team.base.player,
                    FourCC(units_special.tower),
                    GetRectCenterX(team.base.towerRect),
                    GetRectCenterY(team.base.towerRect),
                    0
            )
            BlzSetUnitMaxHP(tower, game_config.units.towerHP)
            SetUnitLifeBJ(tower, game_config.units.towerHP)
        end
    end
end

function createBuildingsForPlayers()
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            local unit = CreateUnit(
                    player.id,
                    FourCC(units_special.mine),
                    GetRectCenterX(player.mineRect),
                    GetRectCenterY(player.mineRect),
                    0
            )

            local ability = BlzGetUnitAbility(unit, FourCC(abilities.mine))
            BlzSetAbilityIntegerLevelField(ability, ABILITY_ILF_GOLD_COST_NDT1, 0, game_config.economy.firstMinePrice)
            BlzSetAbilityRealField(ability, ABILITY_RF_ARF_MISSILE_ARC, game_config.economy.incomeBoost)

            player.economy.mineTextTag = CreateTextTagUnitBJ(getMineTag(player), unit, 0, 10, 204, 204, 0, 0)

            CreateUnit(
                    player.id,
                    FourCC(units_special.main),
                    GetRectCenterX(player.mainRect),
                    GetRectCenterY(player.mainRect),
                    0
            )
            CreateUnit(
                    player.id,
                    FourCC(units_special.laboratory),
                    GetRectCenterX(player.laboratoryRect),
                    GetRectCenterY(player.laboratoryRect),
                    0
            )
            CreateUnit(
                    player.id,
                    FourCC(units_special.shop),
                    GetRectCenterX(player.shopRect),
                    GetRectCenterY(player.shopRect),
                    0
            )

        end
    end
end
Debug.endFile()
Debug.beginFile('main-init.lua')
function initMain()
    initRegions()
    initGame()
end
Debug.endFile()
Debug.beginFile('players-init.lua')
function setAllianceBetweenSpawnPlayers()
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(sumArrayAndElement(getAllSpawnPlayers(team), team.base.player)) do
            for _, anotherPlayer in ipairs(sumArrayAndElement(getAllSpawnPlayers(team), team.base.player)) do
                if player ~= anotherPlayer then
                    SetPlayerAllianceStateBJ(player, anotherPlayer, bj_ALLIANCE_ALLIED_VISION)
                    SetPlayerAllianceStateBJ(anotherPlayer, player, bj_ALLIANCE_ALLIED_VISION)
                end
            end
        end
    end
end

function setEnemyBetweenPlayers()
    local players = {}
    ForForce(GetPlayersAll(), function()
        table.insert(players, GetEnumPlayer())
    end)

    for _, player in ipairs(players) do
        for _, anotherPlayer in ipairs(players) do
            if player ~= anotherPlayer then
                SetPlayerAllianceStateBJ(player, anotherPlayer, bj_ALLIANCE_UNALLIED)
                SetPlayerAllianceStateBJ(anotherPlayer, player, bj_ALLIANCE_UNALLIED)
            end
        end
    end

end

function getAllSpawnPlayers(team)
    local spawnPlayer = {}
    for _, player in ipairs(team.players) do
        table.insert(spawnPlayer, player.spawnPlayerId)
    end
    return spawnPlayer
end

function setAllianceBetweenPlayers()
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            CreateFogModifierRect(player.id, FOG_OF_WAR_VISIBLE, GetPlayableMapRect(), TRUE, TRUE)
            SetPlayerState(player.id, PLAYER_STATE_RESOURCE_GOLD, game_config.economy.startGold)
            for _, anotherPlayer in ipairs(team.players) do
                if player ~= anotherPlayer then
                    SetPlayerAllianceStateBJ(player.id, anotherPlayer.id, bj_ALLIANCE_ALLIED_VISION)
                    SetPlayerAllianceStateBJ(anotherPlayer.id, player.id, bj_ALLIANCE_ALLIED_VISION)
                end
            end
        end
    end
end

function setAllianceBetweenPlayersAndSpawnPlayers()
    for teamNumber, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            for _, spawnPlayer in ipairs(sumArrayAndElement(getAllSpawnPlayers(team), team.base.player)) do
                SetPlayerName(spawnPlayer, GetPlayerName(player.id))
                SetPlayerColor(spawnPlayer, GetPlayerColor(player.id))
                SetPlayerAlliance(spawnPlayer, player.id, ALLIANCE_SHARED_VISION, TRUE)
                SetPlayerAllianceStateBJ(player.id, spawnPlayer, bj_ALLIANCE_ALLIED_VISION)
                SetPlayerAllianceStateBJ(spawnPlayer, player.id, bj_ALLIANCE_ALLIED_VISION)
            end
        end
        SetPlayerName(team.base.player, 'Team ' .. teamNumber)
        SetPlayerColor(team.base.player, GetPlayerColor(Player(teamNumber - 1)))
    end
end

function sumArrayAndElement(array, element)
    local resultArray = {}
    for i = 1, #array do
        table.insert(resultArray, array[i])
    end
    table.insert(resultArray, element)
    return resultArray
end

function changeColorAndNameSpawnPlayers()
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            SetPlayerName(player.spawnPlayerId, GetPlayerName(player.id))
            SetPlayerColor(player.spawnPlayerId, GetPlayerColor(player.id))
        end
    end
end

function addWorkers()
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            if type(player.workerRect) == "table" then
                for _, rect in ipairs(player.workerRect) do
                    CreateUnit(
                            player.id,
                            FourCC(units_special.builder),
                            GetRectCenterX(rect),
                            GetRectCenterY(rect),
                            0
                    )
                end
            else
                CreateUnit(
                        player.id,
                        FourCC(units_special.builder),
                        GetRectCenterX(player.workerRect),
                        GetRectCenterY(player.workerRect),
                        0
                )
            end
        end
    end
end

function initCamera()
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            SetCameraPositionForPlayer(player.id, GetRectCenterX(player.workerRect), GetRectCenterY(player.workerRect))
        end
    end
end

function changeAvailableUnitsForPlayers()

    local isMirror = game_config.units.isUnitsMirror
    local mirrorUnits = {}
    mirrorHeroes = {}
    for _, team in ipairs(all_teams) do
        for playerIndex, player in ipairs(team.players) do
            mirrorHeroes[playerIndex] = {}
            for i = 0, 30 do
                mirrorHeroes[playerIndex][i] = getRandomHeroes(heroes_for_build, 3)
            end
        end
    end

    for _, team in ipairs(all_teams) do
        for playerIndex, player in ipairs(team.players) do
            checkHeroAvailable(player, 0)
            for _, unit in ipairs(units_for_build) do
                SetPlayerUnitAvailableBJ(FourCC(unit.id), FALSE, player.id)
                for _, upgrade in ipairs(unit.upgrades) do
                    SetPlayerTechMaxAllowed(player.id, FourCC(upgrade), 0)
                end
            end

            local randomUnits
            if isMirror and mirrorUnits[playerIndex] then
                randomUnits = mirrorUnits[playerIndex]
            else
                randomUnits = getRandomUnits(units_for_build)
                if isMirror then
                    mirrorUnits[playerIndex] = randomUnits
                end
            end

            for _, unit in ipairs(randomUnits) do
                table.insert(player.availableUnits, unit)
                SetPlayerUnitAvailableBJ(FourCC(unit.id), TRUE, player.id)
            end
            reRollHeroes(player, playerIndex, 0)
        end
    end
end

function reRollHeroes(player, position, heroNumber)

    for _, hero in ipairs(heroes_for_build) do
        SetPlayerUnitAvailableBJ(FourCC(hero.id), FALSE, player.id)
    end

    local threeHeroes
    if game_config.units.isHeroesMirror then
        threeHeroes = mirrorHeroes[position][heroNumber]
    else
        threeHeroes = getRandomHeroes(heroes_for_build, game_config.units.countForSelect)
    end
    for _, hero in ipairs(threeHeroes) do
        SetPlayerUnitAvailableBJ(FourCC(hero.id), TRUE, player.id)
    end
end

function getRandomHeroes(heroes, count)

    local availableHeroes = {}
    for _, hero in ipairs(heroes) do
        if hero.active == true then
            table.insert(availableHeroes, hero)
        end
    end

    local selected = {}
    local result = {}

    count = math.min(count, #availableHeroes)

    while #result < count do
        local index = GetRandomInt(1, #availableHeroes)
        if not selected[index] then
            table.insert(result, availableHeroes[index])
            selected[index] = true
        end
    end

    return result
end

function getRandomUnits(units)
    local groupedUnits = {}
    local randomUnits = {}

    for _, unit in ipairs(units) do
        if not groupedUnits[unit.position] then
            groupedUnits[unit.position] = {}
        end
        if (unit.active == true) then
            table.insert(groupedUnits[unit.position], unit)
        end
    end

    for _, groupedUnit in ipairs(groupedUnits) do
        local randomIndex = GetRandomInt(1, #groupedUnit)
        table.insert(randomUnits, groupedUnit[randomIndex])
    end

    return randomUnits
end
Debug.endFile()
Debug.beginFile('regions-init.lua')
regions = {}
function initRegions()
    for name, value in pairs(_G) do
        if string.sub(name, 1, 7) == "gg_rct_" then
            local parts = split(string.sub(name, 8), "_")

            local currentTable = regions
            for i, part in ipairs(parts) do
                if i == #parts then
                    currentTable[part] = value
                else
                    currentTable[part] = currentTable[part] or {}
                    currentTable = currentTable[part]
                end
            end
        end
    end
end

function split(str, delimiter)
    local result = {}
    for match in (str..delimiter):gmatch("(.-)"..delimiter) do
        if tonumber(match) then
            table.insert(result, tonumber(match))
        else
            table.insert(result, match)
        end
    end
    return result
end
Debug.endFile()
Debug.beginFile('main.lua')
OnInit(function()
    initGlobalVariables()
    initStartGameUI()
    startGameUI()
    configShop()
end)
Debug.endFile()

Debug.beginFile('shop-config.lua')
function configShop()
    BUY_ABLE_ITEMS = {
        'afac',
        'spsh',
        'ajen',
        'bgst',
        'belv',
        'cnob',
        'ratc',
        'clfm',
        'gcel',
        'hval',
        'hcun',
        'rhth',
        'kpin',
        'lgdh',
        'mcou',
        'odef',
        'pmna',
        'rde3',
        'rlif',
        'ciri',
        'brac',
        'sbch',
        'rwiz',
        'evtl',
        'lhst',
        'ward',
        'desc',
        'gemt',
        'ocor',
        'ofir',
        'oli2',
        'oslo',
        'oven'
    }
end
Debug.endFile()
Debug.beginFile('start-game.lua')
function startGame()
    initMain()
    initGameTimer()
    initTriggers()
end
Debug.endFile()
Debug.beginFile('game-time-timer.lua')
function initGameTimer()
    totalGameSeconds = 0
    local gameTimer = CreateTimer()
    TimerStart(gameTimer, 1.0, true, function()
        for _, team in ipairs(all_teams) do
            for _, player in ipairs(team.players) do
                if GetLocalPlayer() == player.id then
                    BlzFrameSetVisible(player.multiFrame, true)
                end
            end
        end
        totalGameSeconds = totalGameSeconds + 1
    end)
end

function GetFormattedGameTime()
    local hours = math.floor(totalGameSeconds / 3600)
    local mins = math.floor((totalGameSeconds % 3600) / 60)
    local secs = totalGameSeconds % 60

    if hours > 0 then
        return string.format("%d:%02d:%02d", hours, mins, secs)
    elseif mins > 0 then
        return string.format("%02d:%02d", mins, secs)
    else
        return string.format("%02d", secs)
    end
end
Debug.endFile()

Debug.beginFile('center-control-trigger.lua')
function centerControlTrigger()
    for _, team in ipairs(all_teams) do
        local trig = CreateTrigger()
        TriggerRegisterEnterRectSimple(trig, team.base.addGoldRect)
        TriggerAddAction(trig, function()
            local unit = GetTriggerUnit()
            local trgPlayer = GetOwningPlayer(unit)
            local isAddGold = false
            for _, player in ipairs(team.players) do
                if (player.spawnPlayerId == trgPlayer) then
                    isAddGold = true
                end
            end
            if isAddGold == true then
                for _, player in ipairs(team.players) do
                    player.economy.incomeForCenter = game_config.economy.incomeForCenter
                end

                for _, otherTeam in ipairs(all_teams) do
                    if otherTeam ~= team then
                        for _, player in ipairs(otherTeam.players) do
                            player.economy.incomeForCenter = 0
                        end
                    end
                end
            end
        end)
    end
end
Debug.endFile()
Debug.beginFile('damage-detect-trigger.lua')
function damageDetectTrigger()
    local trig = CreateTrigger()
    TriggerRegisterAnyUnitEventBJ(trig, EVENT_PLAYER_UNIT_DAMAGED)
    TriggerAddAction(trig, function()
        local source = GetEventDamageSource()
        if GetUnitTypeId(source) == FourCC(units_special.tower) or GetUnitTypeId(source) == FourCC(units_special.base) then
            return
        end
        local sourcePlayer = GetOwningPlayer(source)
        for _, team in ipairs(all_teams) do
            for _, player in ipairs(team.players) do
                if sourcePlayer == player.spawnPlayerId then
                    player.totalDamage = math.floor(player.totalDamage + GetEventDamage())
                    local userData = GetUnitUserData(source)
                    if userData >= START_INDEX_HEROES then
                        for _, hero in ipairs(player.heroes) do
                            if hero.id == userData then
                                hero.damage = math.floor(hero.damage + GetEventDamage())
                            end
                        end
                    end
                    return
                end
            end
        end
    end)
end
Debug.endFile()
Debug.beginFile('dead-detect-trigger.lua')
function deadDetectTrigger()
    local trig = CreateTrigger()
    TriggerRegisterAnyUnitEventBJ(trig, EVENT_PLAYER_UNIT_DEATH)
    TriggerAddAction(trig, function()
        local source = GetKillingUnit()
        if GetUnitTypeId(source) == FourCC(units_special.tower) or GetUnitTypeId(source) == FourCC(units_special.base) then
            return
        end
        local sourcePlayer = GetOwningPlayer(source)
        for _, team in ipairs(all_teams) do
            for _, player in ipairs(team.players) do
                if sourcePlayer == player.spawnPlayerId then
                    player.totalKills = math.floor(player.totalKills + 1)
                    local userData = GetUnitUserData(source)
                    if userData >= START_INDEX_HEROES then
                        for _, hero in ipairs(player.heroes) do
                            if hero.id == userData then
                                hero.kills = hero.kills + 1
                            end
                        end
                    end
                    return
                end
            end
        end
    end)
end

function isHeroOrSummon(id)
    for _, hero in ipairs(heroes_for_build) do
        if hero.id == id then
            return true
        end
    end
    return false
end
Debug.endFile()
Debug.beginFile('enable-update-trigger.lua')
function enableUpdateTrigger()
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            local trig = CreateTrigger()
            TriggerRegisterPlayerUnitEvent(trig, player.id, EVENT_PLAYER_UNIT_CONSTRUCT_FINISH, nil)
            TriggerAddAction(trig, function()

                local unit = GetTriggerUnit()
                local id = GetUnitTypeId(unit)
                local upgrades = getUpgradesById(('>I4'):pack(id))

                for _, upgrade in ipairs(upgrades) do
                    SetPlayerTechMaxAllowed(GetTriggerPlayer(), FourCC(upgrade), 3)
                end
            end)
        end
    end
end

function getUpgradesById(id)
    for _, unit in ipairs(units_for_build) do
        if unit.id == id then
            return unit.upgrades
        end
    end
    return {}
end
Debug.endFile()
Debug.beginFile('finish-research-trigger.lua')
function finishResearchTrigger()
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            local trig = CreateTrigger()
            TriggerRegisterAnyUnitEventBJ(trig, EVENT_PLAYER_UNIT_RESEARCH_FINISH )
            TriggerAddAction(trig, function()
                SetPlayerTechResearchedSwap(GetResearched(), GetPlayerTechCountSimple(GetResearched(), player.id), player.spawnPlayerId)
            end)
        end
    end
end
Debug.endFile()
Debug.beginFile('gold-extractor-trigger.lua')
function goldExtractorTrigger()
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            local trig = CreateTrigger()
            TriggerRegisterPlayerUnitEvent(trig, player.id, EVENT_PLAYER_UNIT_SPELL_EFFECT)
            TriggerAddCondition(trig, Condition(function()
                return GetSpellAbilityId() == FourCC(abilities.mine)
            end))
            TriggerAddAction(trig, function()
                local abilityIntegerId = GetSpellAbilityId()
                local ability = BlzGetUnitAbility(GetTriggerUnit(), abilityIntegerId)
                player.economy.minePrice = player.economy.minePrice + game_config.economy.nextMineDiffPrice
                player.economy.income = player.economy.income + game_config.economy.incomeBoost
                player.economy.mineLevel = player.economy.mineLevel + 1
                BlzSetAbilityIntegerLevelField(ability, ABILITY_ILF_GOLD_COST_NDT1, 0, player.economy.minePrice)

                SetPlayerState(player.id, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(player.id, PLAYER_STATE_RESOURCE_GOLD) + game_config.economy.nextMineDiffPrice)

                DestroyTextTag(player.economy.mineTextTag)
                player.economy.mineTextTag = CreateTextTagUnitBJ(getMineTag(player), GetTriggerUnit(), 0, 10, 204, 204, 0, 0)
            end)
        end
    end
end

function getMineTag(player)
    return 'Level: ' .. player.economy.mineLevel .. ' (' .. player.economy.income * 60 .. '/m) next: ' .. (player.economy.income + game_config.economy.incomeBoost) * 60 .. '/m'
end

Debug.endFile()
Debug.beginFile('hero-construct-trigger.lua')
START_INDEX_HEROES = 1000
function heroConstructTrigger()
    heroGlobalId = START_INDEX_HEROES
    for _, team in ipairs(all_teams) do
        for playerIndex, player in ipairs(team.players) do
            local trig = CreateTrigger()
            TriggerRegisterPlayerUnitEventSimple(trig, player.id, EVENT_PLAYER_UNIT_CONSTRUCT_FINISH)
            TriggerAddAction(trig, function()
                if isHero(('>I4'):pack(GetUnitTypeId(GetTriggerUnit()))) then
                    local group = GetUnitsOfPlayerAndTypeId(player.id, FourCC(units_special.heroBuilder))
                    KillUnit(GroupPickRandomUnit(group))
                    DestroyGroup(group)
                    local unitId = GetUnitTypeId(GetTriggerUnit())

                    if game_config.units.itemCapacity == 0 then
                        UnitRemoveAbility(GetTriggerUnit(), FourCC(abilities.inventory[6]))
                    else
                        UnitAddAbility(GetTriggerUnit(), FourCC(abilities.inventory[game_config.units.itemCapacity]))
                    end
                    if (game_config.units.heroStartLevel > 1) then
                        SetHeroLevel(GetTriggerUnit(), game_config.units.heroStartLevel, false)
                    end
                    table.insert(player.heroes, {
                        status = "new",
                        building = GetTriggerUnit(),
                        name = GetHeroProperName(GetTriggerUnit()),
                        unit = nil,
                        id = heroGlobalId,
                        newSkills = {},
                        unitConfig = getHeroUnitId(('>I4'):pack(unitId)),
                        icon = BlzGetAbilityIcon(unitId),
                        kills = 0,
                        damage = 0
                    })
                    heroGlobalId = heroGlobalId + 1
                    player.food = player.food + 5
                    if isDuplicateHero(('>I4'):pack(unitId), player.heroes) == false then
                        updateAbilityPanel(player, getHeroUnitId(('>I4'):pack(unitId)))
                    end
                    reRollHeroes(player, playerIndex, #player.heroes)
                else
                    player.food = player.food + getFoodCostUnit(('>I4'):pack(GetUnitTypeId(GetTriggerUnit())))
                end
                end)
        end
    end
end

function isDuplicateHero(unitId, heroes)
    local count = 0
    for _, hero in ipairs(heroes) do
        if unitId == hero.unitConfig.id then
            count = count + 1
        end
    end
    if count > 1 then
        return true
    else
        return false
    end
    end

function getHeroUnitId(searchId)
    for _, unit in pairs(heroes_for_build) do
        if unit.id == searchId then
            return unit
        end
    end
    return nil
end
function getFoodCostUnit(unitId)
    for _, unit in pairs(units_for_build) do
        if unit.id == unitId then
            return unit.food
        end
    end
    return 0
end
Debug.endFile()


Debug.beginFile('hero-dead-trigger.lua')
function heroDeadTrigger()
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            local trig = CreateTrigger()
            TriggerRegisterTimerEventPeriodic(trig, 1)
            TriggerAddAction(trig, function()
                for _, hero in ipairs(player.heroes) do
                    if IsUnitDeadBJ(hero.unit) and hero.status == 'alive' then
                        hero.status = 'dead'
                    end
                end
            end)
        end
    end
end
Debug.endFile()
Debug.beginFile('hero-learn-ability.lua')
function heroLearnAbility()
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            local trig = CreateTrigger()
            TriggerRegisterPlayerUnitEventSimple(trig, player.id, EVENT_PLAYER_HERO_SKILL)
            TriggerAddAction(trig, function()
                local learnedUnit = GetTriggerUnit()
                local learnedSkill = GetLearnedSkill()
                for _, hero in ipairs(player.heroes) do
                    if learnedUnit == hero.building then
                        table.insert(hero.newSkills, learnedSkill)
                        break
                    end
                end
            end)
        end
    end
end
Debug.endFile()
Debug.beginFile('hero-main.lua')
function initHeroTriggers()
    heroResearchTrigger()
    heroConstructTrigger()
    heroDeadTrigger()
    heroTransferExp()
    heroLearnAbility()
    heroNewSkill()
    wardenTrigger()
    summonLabelTrigger()
end
Debug.endFile()
Debug.beginFile('hero-new-skill.lua')
function heroNewSkill()
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            local trig = CreateTrigger()
            TriggerRegisterTimerEventPeriodic(trig, 1)
            TriggerAddAction(trig, function()
                for _, hero in ipairs(player.heroes) do
                    if hero.status == 'alive' then
                        for i = #hero.newSkills, 1, -1 do
                            SetPlayerAbilityAvailable(player.spawnPlayerId, hero.newSkills[i], true)
                            SelectHeroSkill(hero.unit, hero.newSkills[i])
                            table.remove(hero.newSkills, i)
                        end
                    end
                end
            end)
        end
    end
end
Debug.endFile()

Debug.beginFile('hero-research-trigger.lua')
function heroResearchTrigger()
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            local trig = CreateTrigger()
            TriggerRegisterPlayerUnitEventSimple(trig, player.id, EVENT_PLAYER_UNIT_RESEARCH_FINISH)
            TriggerAddAction(trig, function()
                if (GetResearched() == FourCC(upgrades_special.summonHeroBuilder)) then
                    CreateUnit(player.id, FourCC(units_special.heroBuilder), GetRectCenterX(player.workerRect), GetRectCenterY(player.workerRect), 270)
                    player.heroBuilderCount = player.heroBuilderCount + 1
                    checkHeroAvailable(player, player.heroBuilderCount)
                end
            end)
        end
    end
end

function checkHeroAvailable(player, heroesCount)
    if game_config.units.maxHeroes <= heroesCount then
        SetPlayerTechMaxAllowed(player.id, FourCC(upgrades_special.summonHeroBuilder), 0)
    end
end
Debug.endFile()
Debug.beginFile('hero-transfer-experiance.lua')
function heroTransferExp()
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            local trig = CreateTrigger()
            TriggerRegisterTimerEventPeriodic(trig, 1)
            TriggerAddAction(trig, function()
                for _, hero in ipairs(player.heroes) do
                    if hero.status == 'alive' then
                        local unitExp = GetHeroXP(hero.unit)
                        SetHeroXP(hero.building, unitExp, true)
                    end
                end
            end)
        end
    end
end
Debug.endFile()
Debug.beginFile('summon-label-trigger.lua')
function summonLabelTrigger()
    local trig = CreateTrigger()
    TriggerRegisterAnyUnitEventBJ(trig, EVENT_PLAYER_UNIT_SUMMON)
    TriggerAddAction(trig, function()
        SetUnitUserData(GetSummonedUnit(), GetUnitUserData(GetSummoningUnit()))
        immediatelyMoveUnit(GetSummonedUnit())
    end)
end
Debug.beginFile('warden-trigger.lua')
function wardenTrigger()
    local trig = CreateTrigger()
    TriggerRegisterAnyUnitEventBJ(trig, EVENT_PLAYER_UNIT_DAMAGING)
    TriggerAddAction(trig, function()
        local unit = GetTriggerUnit()
        if GetUnitTypeId(unit) == FourCC('Ewar') then
            local rect = getPlayerBuildRect(GetOwningPlayer(unit))
            local livePercent = GetUnitLifePercent(unit)
            if livePercent <= 20 then
                IssuePointOrder(unit, 'blink', GetRectCenterX(rect), GetRectCenterY(rect))
            end
        end
    end)
end

function getPlayerBuildRect(player)
    for _, team in ipairs(all_teams) do
        for _, p in ipairs(team.players) do
            if p.spawnPlayerId == player then
                return p.spawnRect
            end
        end
    end
    return nil
end
Debug.endFile()
Debug.beginFile('income-trigger.lua')
function incomeTrigger()
    local trig = CreateTrigger()
    TriggerRegisterTimerEventPeriodic(trig, 1.00)
    TriggerAddAction(trig, function()
        for _, team in ipairs(all_teams) do
            for _, player in ipairs(team.players) do

                player.economy.roundUp = not player.economy.roundUp

                local _, percent = getUpkeepTypeAndPercent(player)

                local income = (player.economy.income + player.economy.incomeForCenter)/60
                local incomeWithPercent = (income * percent) / 100
                if (incomeWithPercent == 0) then
                    return
                end

                local roundedIncome
                if player.economy.roundUp then
                    roundedIncome = math.ceil(incomeWithPercent)
                else
                    roundedIncome = math.floor(incomeWithPercent)
                end

                addGold(player, roundedIncome)
            end
        end
    end)
end

upkeepType = {
    NO = 'NO',
    LOW = 'LOW',
    HIGH = 'HIGH'
}

function getUpkeepTypeAndPercent(player)

    if game_config.economy.upkeep == true then
        if player.food > 10 and player.food <= 100 then
            return upkeepType.LOW, 80
        elseif player.food > 100 then
            return upkeepType.HIGH, 60
        else
            return upkeepType.NO, 100
        end
    end
    return nil, 100
end

function addGold(player, gold)
    local currentGold = GetPlayerState(player.id, PLAYER_STATE_RESOURCE_GOLD)
    player.economy.totalGold = player.economy.totalGold + gold
    SetPlayerState(player.id, PLAYER_STATE_RESOURCE_GOLD, currentGold + gold)
end
Debug.endFile()
Debug.beginFile('kill-tower-trigger.lua')
function killTowerTrigger()
    for _, team in ipairs(all_teams) do
        local group = GetUnitsOfPlayerAll(team.base.player)
        ForGroup(group, function()
            local unit = GetEnumUnit()
            local unitId = ('>I4'):pack(GetUnitTypeId(unit))
            if unitId == units_special.tower then
                local trig = CreateTrigger()
                TriggerRegisterUnitEvent(trig, unit, EVENT_UNIT_DEATH)
                TriggerAddAction(trig, function()
                    local unit = GetKillingUnit()
                    local player = GetOwningPlayer(unit)
                    for _, otherTeam in ipairs(all_teams) do
                        if otherTeam.base.player == player then
                            for _, player in ipairs(otherTeam.players) do
                                DisplayTextToPlayer(player.id, 100, 200, '+' .. game_config.economy.goldByTower .. ' gold for killing a tower. ')
                                addGold(player, game_config.economy.goldByTower)
                            end
                            return
                        end
                    end
                end)
            end
        end)
        DestroyGroup(group)
    end
end
Debug.endFile()
Debug.beginFile('lifetime-limit.lua')
function lifetimeLimitTrigger()
    local trig = CreateTrigger()
    TriggerRegisterTimerEventPeriodic(trig, 5.00)
    TriggerAddAction(trig, function()
        for _, team in ipairs(all_teams) do
            for _, player in ipairs(team.players) do
                local allUnits = GetUnitsOfPlayerAll(player.spawnPlayerId)
                ForGroup(allUnits, function()
                    local unit = GetEnumUnit()
                    if not IsUnitType(unit, UNIT_TYPE_DEAD) then
                        local waveNumber = GetUnitUserData(unit)
                        if waveNumber ~= 0 then
                            if (player.waveNumber - waveNumber >= game_config.units.lifetime) then
                                local removeTimer = CreateTimer()
                                local tick = 10
                                local tag = CreateTextTagUnitBJ(tick, unit, 1,  10, 255, 2, 2, 255)
                                TimerStart(removeTimer, 0.5, true, function()
                                    tick = tick - 1
                                    if tick <= 0 then
                                        local effect = AddSpecialEffectLoc( "Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl", GetUnitLoc(unit))
                                        BlzSetSpecialEffectScale( effect, ( 0.30 * I2R(GetUnitLevel(unit)) ) )
                                        DestroyEffect( effect )
                                        RemoveUnit(unit)
                                        DestroyTimer(removeTimer)
                                        DestroyTextTag(tag)
                                    else
                                        DestroyTextTag(tag)
                                        tag = CreateTextTagUnitBJ(tick, unit, 1,  10, 255, 2, 2, 255)
                                    end
                                end)
                            end
                        end
                    end
                end)
                DestroyGroup(allUnits)
            end
        end
    end)
end
Debug.endFile()
Debug.beginFile('lose-trigger.lua')
function loseTrigger()
    for _, team in ipairs(all_teams) do
        local group = GetUnitsOfPlayerAll(team.base.player)
        ForGroup(group, function()
            local unit = GetEnumUnit()
            local unitId = ('>I4'):pack(GetUnitTypeId(unit))
            if unitId == units_special.base then
                local trig = CreateTrigger()
                TriggerRegisterUnitEvent(trig, unit, EVENT_UNIT_DEATH)
                TriggerAddAction(trig, function()
                    finishGame(team)
                end)
            end
        end)
        DestroyGroup(group)
    end
end
Debug.endFile()

Debug.beginFile('main-triggers.lua')
function initTriggers()
    incomeTrigger()
    moveTrigger()
    loseTrigger()
    winTrigger()
    goldExtractorTrigger()
    finishResearchTrigger()
    enableUpdateTrigger()
    customCastAITrigger()
    spellFinishTrigger()
    spawnTrigger()
    initHeroTriggers()
    sellTrigger()
    replaceTrigger()
    summonTrigger()
    statusPanelUpdateTrigger()
    damageDetectTrigger()
    KodoTrigger()
    deadDetectTrigger()
    killTowerTrigger()
    centerControlTrigger()
    tierDetectTrigger()
    lifetimeLimitTrigger()
    goldForKillTrigger()
    if IS_DEBUG_TRIGGER_ON then
        debugTrigger()
        debugTriggerGold()
        debugTriggerFinish()
        debugTriggerFinish2()
    end
end
Debug.endFile()
Debug.beginFile('move-trigger.lua')
additionalDir = 500
function moveTrigger()
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            for i = 1, #player.attackPointRect do
                local trig = CreateTrigger()
                TriggerRegisterTimerEventPeriodic(trig, 10)
                TriggerAddAction(trig, function()
                    local group = GetUnitsInRectAll(player.attackPointRect[i].rect)
                    ForGroup(group, function ()
                        local unit = GetEnumUnit()
                        local owner = GetOwningPlayer(unit)
                        if owner == player.spawnPlayerId then
                            if GetUnitCurrentOrder(unit) == 0 or
                                    GetUnitCurrentOrder(unit) == 851983 then
                                moveByLocation(player.attackPointRect[i], unit)
                            end
                        end
                    end)
                    DestroyGroup(group)
                end)
            end
        end
    end
end

function moveByLocation(rect, unit)
    local x, y
    if rect.direction == 'right' then
        x = GetRectMaxX(rect.rect) + additionalDir
        y = GetUnitY(unit)
    elseif rect.direction == 'down' then
        x = GetUnitX(unit)
        y = GetRectMinY(rect.rect) - additionalDir
    elseif rect.direction == 'left' then
        x = GetRectMinX(rect.rect) - additionalDir
        y = GetUnitY(unit)
    elseif rect.direction == 'up' then
        x = GetUnitX(unit)
        y = GetRectMaxY(rect.rect) + additionalDir
    end
    IssuePointOrderLoc(unit, "attack", Location(x, y))
end

function containsValue(value, array)
    for _, v in ipairs(array) do
        if v == value then
            return true
        end
    end
    return false
end
Debug.endFile()
Debug.beginFile('replace-trigger.lua')
function replaceTrigger()
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            local trig = CreateTrigger()
            TriggerRegisterPlayerUnitEvent(trig, player.id, EVENT_PLAYER_UNIT_SPELL_EFFECT)
            TriggerAddCondition(trig, Condition(function()
                return GetSpellAbilityId() == FourCC(abilities.moveLarge) or
                        GetSpellAbilityId() == FourCC(abilities.moveMedium) or
                        GetSpellAbilityId() == FourCC(abilities.moveSmall)
            end))
            TriggerAddAction(trig, function()
                local location = GetSpellTargetLoc()

                if type(player.buildRect) == "table" then
                    for i in ipairs(player.buildRect) do
                        if isLocationInRectangle(location, player.buildRect[i]) then
                            local unit = GetSpellAbilityUnit()
                            SetUnitPositionLoc(unit, location)
                        end
                    end
                else
                    if isLocationInRectangle(location, player.buildRect) then
                        local unit = GetSpellAbilityUnit()
                        SetUnitPositionLoc(unit, location)
                    end
                end
            end)
        end
    end
end

function isLocationInRectangle(location, rect)
    rectMinX = GetRectMinX(rect)
    rectMinY = GetRectMinY(rect)
    rectMaxX = GetRectMaxX(rect)
    rectMaxY = GetRectMaxY(rect)

    local locX = GetLocationX(location)
    local locY = GetLocationY(location)

    return locX >= rectMinX and locX <= rectMaxX and locY >= rectMinY and locY <= rectMaxY
end

function replaceCell(player)
    if type(player.buildRect) == "table" then
        for i in ipairs(player.buildRect) do
            local group = GetUnitsInRectAll(player.buildRect[i])
            replaceGroupCell(group)
        end
    else
        local group = GetUnitsInRectAll(player.buildRect)
        replaceGroupCell(group)
    end
end

function replaceGroupCell(group)
    ForGroup(group, function()
        local unit = GetEnumUnit()
        local ability = BlzGetUnitAbility(unit, FourCC(abilities.sell100))
        if ability ~= nil then
            UnitAddAbility(unit, FourCC(abilities.sell75))
            UnitRemoveAbilityBJ(FourCC(abilities.sell100), unit)
        end
    end)
    DestroyGroup(group)
end
Debug.endFile()
Debug.beginFile('sell-trigger.lua')
function sellTrigger()
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            local trig = CreateTrigger()
            TriggerRegisterPlayerUnitEvent(trig, player.id, EVENT_PLAYER_UNIT_SPELL_EFFECT)
            TriggerAddCondition(trig, Condition(function()
                return GetSpellAbilityId() == FourCC(abilities.sell100) or GetSpellAbilityId() == FourCC(abilities.sell75)
            end))
            TriggerAddAction(trig, function()
                local unit = GetSpellAbilityUnit()
                local cost = GetUnitGoldCost(GetUnitTypeId(unit))
                TriggerSleepAction(0.1)
                RemoveUnit(unit)
                local currentGold = GetPlayerState(player.id, PLAYER_STATE_RESOURCE_GOLD)

                if GetSpellAbilityId() == FourCC(abilities.sell100) then
                    SetPlayerState(player.id, PLAYER_STATE_RESOURCE_GOLD, currentGold + cost)
                else
                    SetPlayerState(player.id, PLAYER_STATE_RESOURCE_GOLD, currentGold + math.floor(cost * 0.75))
                end
                player.food = player.food - getFoodCostUnit(('>I4'):pack(GetUnitTypeId(unit)))
            end)
        end
    end
end

function replaceCell(player)
    if type(player.buildRect) == "table" then
        for i in ipairs(player.buildRect) do
            local group = GetUnitsInRectAll(player.buildRect[i])
            replaceGroupCell(group)
        end
    else
        local group = GetUnitsInRectAll(player.buildRect)
        replaceGroupCell(group)
    end
end

function replaceGroupCell(group)
    ForGroup(group, function()
        local unit = GetEnumUnit()
        local ability = BlzGetUnitAbility(unit, FourCC(abilities.sell100))
        if ability ~= nil then
            UnitAddAbility(unit, FourCC(abilities.sell75))
            UnitRemoveAbilityBJ(FourCC(abilities.sell100), unit)
        end
    end)
    DestroyGroup(group)
end
Debug.endFile()
Debug.beginFile('spawn-trigger.lua')
function spawnTrigger()
    local trig = CreateTrigger()
    TriggerRegisterTimerEventPeriodic(trig, 1)
    TriggerAddAction(trig, function()
        for _, team in ipairs(all_teams) do
            for _, player in ipairs(team.players) do
                if player.spawnTimer <= 0 then
                    player.waveNumber = player.waveNumber + 1
                    processGroupForSpawn(player)
                    player.spawnTimer = game_config.spawnPolicy.interval * #team.players + game_config.spawnPolicy.dif
                    replaceCell(player)
                end
                player.spawnTimer = player.spawnTimer - 1
            end
        end
    end)
end

function handleUnitSpawn(player, id, x, y)
    local parentId = getParentUnitId(('>I4'):pack(id))
    if parentId then
        local unit = CreateUnit(player.spawnPlayerId, FourCC(parentId), x, y, 270)
        SetUnitUserData(unit, player.waveNumber)
        SetUnitAcquireRangeBJ(unit, GetUnitAcquireRange(unit) * game_config.units.range)
        immediatelyMoveUnit(unit)
    end
end

function handleHeroSpawn(player, unit, x, y)
    local hero = getHero(player.heroes, unit)
    if hero.status == "new" then
        local unit = CreateUnit(player.spawnPlayerId, FourCC(hero.unitConfig.parentId), x, y, 270)
        if (game_config.units.heroStartLevel > 1) then
            SetHeroLevel(unit, game_config.units.heroStartLevel, false)
        end
        SetUnitUserData(unit, hero.id)
        BlzSetHeroProperName(unit, hero.name)
        SetUnitAcquireRangeBJ(unit, GetUnitAcquireRange(unit) * game_config.units.range)
        hero.status = "alive"
        hero.unit = unit
        immediatelyMoveUnit(unit)
    elseif hero.status == "dead" then
        hero.status = "alive"
        ReviveHeroLoc(hero.unit, Location(x, y), false)
        SetUnitManaPercentBJ(hero.unit, 100)
        immediatelyMoveUnit(hero.unit)
    end
    SynchronizeInventory(unit, hero.unit)
end

function SynchronizeInventory(hero1, hero2)
    for slot = 0, 5 do
        local item = UnitItemInSlot(hero1, slot)

        local itemForDelete = UnitItemInSlot(hero2, slot)
        if itemForDelete then
            RemoveItem(itemForDelete)
        end

        if item then
            UnitAddItemToSlotById(hero2, GetItemTypeId(item), slot)
        end
    end
end

function table.contains(table, element)
    for _, value in pairs(table) do
        if value == element then
            return true
        end
    end
    return false
end

function getHero(heroes, unit)
    for _, hero in ipairs(heroes) do
        if hero.building == unit then
            return hero
        end
    end
    return nil
end

function processGroupForSpawn(player)
    local function processRect(buildRect, spawnRect)
        local groupForBuild = GetUnitsInRectAll(buildRect)
        ForGroup(groupForBuild, function()
            local unit = GetEnumUnit()
            local id = GetUnitTypeId(unit)
            local owner = GetOwningPlayer(unit)
            if owner == player.id then
                local x, y = calculateDif(buildRect, spawnRect, unit)
                if isHero(('>I4'):pack(id)) then
                    handleHeroSpawn(player, unit, x, y)
                else
                    handleUnitSpawn(player, id, x, y)
                end
            end
        end)
        DestroyGroup(groupForBuild)
    end

    processRect(player.buildRect, player.spawnRect)
end

function getParentUnitId(searchId)
    for _, unit in pairs(units_for_build) do
        if unit.id == searchId then
            return unit.parentId
        end
    end
    return nil
end

function isHero(id)
    for _, hero in ipairs(heroes_for_build) do
        if hero.id == id then
            return true
        end
    end
    return false
end
Debug.endFile()
Debug.beginFile('status-panel-update-trigger.lua')
function statusPanelUpdateTrigger()
    local trig = CreateTrigger()
    TriggerRegisterTimerEventPeriodic(trig, 1.00)
    TriggerAddAction(trig, function()
        updatePanelForAllPlayers()
        updateStatisticPanel()
    end)
end
Debug.endFile()
Debug.beginFile('summon-trigger.lua')
function summonTrigger()
    local trig = CreateTrigger()
    TriggerRegisterAnyUnitEventBJ(trig, EVENT_PLAYER_UNIT_SUMMON)
    TriggerAddAction(trig, function()
        SetUnitUserData(GetSummonedUnit(), GetUnitUserData(GetSummoningUnit()))
    end)
end
Debug.endFile()
Debug.beginFile('tier-detect-trigger.lua')
function tierDetectTrigger()
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            local trig = CreateTrigger()
            TriggerRegisterPlayerUnitEventSimple( trig, player.id, EVENT_PLAYER_UNIT_UPGRADE_FINISH )
            TriggerAddAction(trig, function()
                if (GetUnitTypeId(GetTriggerUnit()) == FourCC(units_special.t2)) then
                    player.tier = 'T2'
                end
                if (GetUnitTypeId(GetTriggerUnit()) == FourCC(units_special.t3)) then
                    player.tier = 'T3'
                end

            end)
        end
    end
end
Debug.endFile()
Debug.beginFile('gold-for-kill-trigger.lua')
function goldForKillTrigger()
    if game_config.economy.goldForKill == 0 then
        return
    end

    local trig = CreateTrigger()
    TriggerRegisterAnyUnitEventBJ(trig, EVENT_PLAYER_UNIT_DEATH)
    TriggerAddAction(trig, function()
        local killerUnit = GetKillingUnit()

        local cost = getBuildingCost(('>I4'):pack(GetUnitTypeId(GetTriggerUnit())))
        if cost > 0 then
            local gold = math.floor((game_config.economy.goldForKill/100) * cost)
            local sourcePlayer = GetOwningPlayer(killerUnit)
            for _, team in ipairs(all_teams) do
                for _, player in ipairs(team.players) do
                    if sourcePlayer == player.spawnPlayerId then
                        player.economy.totalGoldForKills = player.economy.totalGoldForKills + gold
                        addGold(player, gold)
                        return
                    end
                end
            end
        end
    end)
end

function getBuildingCost(id)
    for _, unit in ipairs(units_for_build) do
        if unit.parentId == id then
            return GetUnitGoldCost(FourCC(unit.id))
        end
        if unit.otherForm then
            for _, form in ipairs(unit.otherForm) do
                if form == id then
                    return GetUnitGoldCost(FourCC(unit.id))
                end
            end
        end
    end
    for _, hero in ipairs(heroes_for_build) do
        if hero.parentId == id then
            return game_config.units.heroCost
        end
        if hero.otherForm then
            for _, form in ipairs(hero.otherForm) do
                if form == id then
                    return game_config.units.heroCost
                end
            end
        end
    end
    return 0
end
Debug.endFile()
Debug.beginFile('kodo-trigger.lua')
function KodoTrigger()
    local trig = CreateTrigger()
    TriggerRegisterAnyUnitEventBJ(trig, EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
    TriggerAddAction(trig, function()
        local order = GetIssuedOrderId()
        if order == 852104 then
            TriggerSleepAction(3)
            immediatelyMoveUnit(GetTriggerUnit())
        end
    end)
end
Debug.endFile()
Debug.beginFile('spell-cast-trigger.lua')
custom_cast_ai_params = {
    {
        unitId = 'u006',
        order = 'antimagicshell',
        radius = 500,
        timeout = 2.00,
        orderTarget = 'conditionUnit',
        condition = {
            target = 'ally'
        }
    },
    {
        unitId = 'h00H',
        order = 'innerfire',
        radius = 500,
        timeout = 5.00,
        orderTarget = 'conditionUnit',
        condition = {
            target = 'ally'
        }
    },
    {
        unitId = 'h00I',
        order = 'invisibility',
        radius = 500,
        timeout = 1.00,
        orderTarget = 'conditionUnit',
        condition = {
            target = 'ally',
            livePercent = 20
        }
    },
    {
        unitId = 'e00J',
        order = 'rejuvination',
        radius = 500,
        timeout = 2.00,
        orderTarget = 'conditionUnit',
        condition = {
            target = 'ally',
            livePercent = 90
        }
    },
    {
        unitId = 'e00J',
        order = 'bearform',
        radius = 500,
        timeout = 2.00,
        orderTarget = 'conditionUnit',
        condition = {
            target = 'itself',
            livePercent = 75
        }
    },
    {
        unitId = 'e00I',
        order = 'revanform',
        radius = 900,
        timeout = 2.00,
        orderTarget = 'conditionUnit',
        condition = {
            target = 'enemy'
        }
    },
    {
        unitId = 'e00I',
        order = 'cyclone',
        radius = 500,
        timeout = 3.00,
        orderTarget = 'conditionUnit',
        condition = {
            target = 'enemy'
        }
    },
    {
        unitId = 'Ofar',
        order = 'firebolt',
        radius = 500,
        timeout = 5.00,
        orderTarget = 'conditionUnit',
        condition = {
            target = 'enemy'
        }
    },
    {
        unitId = 'e00I',
        order = 'ravenform',
        radius = 500,
        timeout = 1.00,
        orderTarget = 'itself',
        condition = {
            target = 'enemy',
            isFly = true,
            exceptionUnits = {'u00A'}
        }
    },
    {
        unitId = 'edtm',
        order = 'unravenform',
        radius = 500,
        timeout = 2.00,
        orderTarget = 'itself',
        condition = {
            target = 'itself'
        }
    },
    {
        unitId = 'ucrm',
        order = 'unburrow',
        radius = 500,
        timeout = 5.00,
        orderTarget = 'itself',
        condition = {
            target = 'itself'
        }
    }
}
function customCastAITrigger()
    for _, castParam in ipairs(custom_cast_ai_params) do
        createTriggerByCastParam(castParam)
    end
end

function createTriggerByCastParam(castParam)
    local trig = CreateTrigger()
    TriggerRegisterTimerEventPeriodic(trig, castParam.timeout)
    TriggerAddAction(trig, function()
        local group = GetUnitsOfTypeIdAll(FourCC(castParam.unitId))
        ForGroup(group, function()

            if castParam.condition.target == 'ally' or castParam.condition.target == 'enemy' then
                local unitsGroup = GetUnitsInRangeOfLocMatching(
                        castParam.radius,
                        GetUnitLoc(GetEnumUnit()),
                        Filter(function()
                            local filterUnit = GetFilterUnit()
                            if castParam.condition then
                                if castParam.condition.exceptionUnits then
                                    for _, unit in ipairs(castParam.condition.exceptionUnits) do
                                        if GetUnitTypeId(filterUnit) == FourCC(unit) then
                                            return false
                                        end
                                    end
                                end
                                if castParam.condition.livePercent then
                                    local livePercent = GetUnitLifePercent(filterUnit)
                                    if castParam.condition.livePercent <= livePercent then
                                        return false
                                    end
                                end
                                if castParam.condition.isFly then
                                    if BlzGetUnitMovementType(filterUnit) == MOVE_TYPE_FLY then
                                        return true
                                    end
                                end
                            end
                            local ownerFilterUnit = GetOwningPlayer(filterUnit)

                            if castParam.condition.target == 'ally' then
                                return isPlayerAlly(GetOwningPlayer(GetEnumUnit()), ownerFilterUnit)
                            elseif castParam.condition.target == 'enemy' then
                                return isPlayerEnemy(GetOwningPlayer(GetEnumUnit()), ownerFilterUnit)
                            end
                        end)
                )

                if CountUnitsInGroup(unitsGroup) >= 1 then
                    local randomUnit = GroupPickRandomUnit(unitsGroup)

                    if castParam.orderTarget == 'conditionUnit' then
                        IssueTargetOrderBJ(GetEnumUnit(), castParam.order, randomUnit)
                    elseif castParam.orderTarget == 'itself' then
                        IssueImmediateOrder(GetEnumUnit(), castParam.order)
                    end
                end
                DestroyGroup(unitsGroup)
            elseif castParam.condition.target == 'itself' then
                if castParam.condition then
                    if castParam.condition.livePercent then
                        local livePercent = GetUnitLifePercent(GetEnumUnit())
                        if castParam.condition.livePercent >= livePercent then
                            IssueImmediateOrder(GetEnumUnit(), castParam.order)
                        end
                    else
                        IssueImmediateOrder(GetEnumUnit(), castParam.order)
                    end
                end
            end

        end)
    end)
end

function isPlayerAlly(player, checkPlayer)
    for _, team in ipairs(all_teams) do
        for _, p in ipairs(team.players) do
            if p.spawnPlayerId == player then
                for _, spawnP in ipairs(getAllSpawnPlayers(team)) do
                    if spawnP == checkPlayer then
                        return true
                    end
                end
            end
        end
    end
    return false
end

function isPlayerEnemy(player, checkPlayer)
    for _, team in ipairs(all_teams) do
        for _, p in ipairs(team.players) do
            if p.spawnPlayerId == player then
                for _, teamOther in ipairs(all_teams) do
                    if (teamOther ~= team) then
                        for _, spawnP in ipairs(getAllSpawnPlayers(teamOther)) do
                            if spawnP == checkPlayer then
                                return true
                            end
                        end
                    end
                end
            end
        end
    end
    return false
end
Debug.endFile()
Debug.beginFile('spell-finish-trigger.lua')
function spellFinishTrigger()
    local trig = CreateTrigger()
    TriggerRegisterAnyUnitEventBJ(trig, EVENT_PLAYER_UNIT_SPELL_FINISH)
    TriggerAddAction(trig, function()
        immediatelyMoveUnit(GetTriggerUnit())
    end)
end

function immediatelyMoveUnit(unit)
    local attackPointRect = getAttackPointRect(GetOwningPlayer(unit))
    for _, atPointRect in ipairs(attackPointRect) do
        if IsUnitInRect(atPointRect.rect, unit) then
            moveByLocation(atPointRect, unit)
            return
        end
    end
end

function IsUnitInRect(r, u)
    return GetUnitX(u) > GetRectMinX(r)-32 and GetUnitX(u) < GetRectMaxX(r)+32 and GetUnitY(u) > GetRectMinY(r)-32 and GetUnitY(u) < GetRectMaxY(r)+32
end


function getAttackPointRect(castPlayer)
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            if player.spawnPlayerId == castPlayer then
                return player.attackPointRect
            end
        end
    end
end
Debug.endFile()
Debug.beginFile('win-trigger.lua')
function winTrigger()
    local trig = CreateTrigger()
    TriggerRegisterTimerEventPeriodic(trig, 1.00)
    TriggerAddAction(trig, function()
        local notLoseTeams = {}
        for _, team in ipairs(all_teams) do
            if team.lose ~= true then
                table.insert(notLoseTeams, team)
            end
        end
        if #notLoseTeams == 1 then
            for _, player in ipairs(notLoseTeams[1].players) do
                CustomVictoryBJ(player.id, true, true)
            end
        end
    end)
end
Debug.endFile()
Debug.beginFile('start-game.lua')
function initAbilitiesPanel()
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            local buttonAbility = BlzCreateSimpleFrame('AbilitiesButton', BlzGetOriginFrame(ORIGIN_FRAME_GAME_UI, 0), 0)
            BlzFrameSetAbsPoint(buttonAbility, FRAMEPOINT_BOTTOMLEFT, 0.2, 0.13)
            BlzFrameSetSize(buttonAbility, 0.08, 0.03)
            BlzFrameSetVisible(buttonAbility, GetLocalPlayer() == player.id)

            local panelAbility = BlzCreateFrameByType("BACKDROP", "MyPanelAbility", BlzGetFrameByName("ConsoleUIBackdrop", 0), "QuestButtonBackdropTemplate", 0)
            BlzFrameSetPoint(panelAbility, FRAMEPOINT_BOTTOM, buttonAbility, FRAMEPOINT_TOP, 0, 0)
            BlzFrameSetVisible(panelAbility, false)

            player.unitsWithAbility = 0
            for _, unit in ipairs(player.availableUnits) do
                local isAdded = initButtonForUnit(unit, panelAbility, player, player.unitsWithAbility)
                if isAdded then
                    player.unitsWithAbility = player.unitsWithAbility + 1
                end
            end
            player.unitsWithAbility = player.unitsWithAbility + 1
            player.buttonAbility = buttonAbility
            player.panelAbility = panelAbility
            player.isVisiblePanelAbility = false
            BlzFrameSetSize(player.panelAbility, 0.2, player.unitsWithAbility * 0.025)

            local trigger = CreateTrigger()
            BlzTriggerRegisterFrameEvent(trigger, buttonAbility, FRAMEEVENT_CONTROL_CLICK)
            TriggerAddAction(trigger, function()
                if GetTriggerPlayer() ~= GetLocalPlayer() then
                    return
                end
                if player.isVisiblePanelAbility then
                    player.isVisiblePanelAbility = false
                    BlzFrameSetVisible(player.panelAbility, player.isVisiblePanelAbility)
                else
                    player.isVisiblePanelAbility = true
                    BlzFrameSetVisible(player.panelAbility, player.isVisiblePanelAbility)
                end
            end)
        end
    end
end

function updateAbilityPanel(player, hero)
    initButtonForUnit(hero, player.panelAbility, player, player.unitsWithAbility)
    player.unitsWithAbility = player.unitsWithAbility + 1
    BlzFrameSetSize(player.panelAbility, 0.2, (player.unitsWithAbility + 1) * 0.025)
end

function initButtonForUnit(unit, containerFrame, player, position)
    if unit.abilities then
        local button = BlzCreateFrame("MyIconButtonTemplate", containerFrame, 0, 0)
        BlzFrameSetPoint(button, FRAMEPOINT_TOPLEFT, containerFrame, FRAMEPOINT_TOPLEFT, 0.01, -(0.01 + (BlzFrameGetHeight(button) * position)))

        local buttonTexture = BlzGetFrameByName("MyButtonBackdropTemplate", 0)
        BlzFrameSetTexture(buttonTexture, BlzGetAbilityIcon(FourCC(unit.parentId)), 0, true)
        for id, ability in ipairs(unit.abilities) do
            local buttonAbility = BlzCreateFrame("MyIconButtonTemplate", containerFrame, 0, 0)
            BlzFrameSetPoint(buttonAbility, FRAMEPOINT_LEFT, button, FRAMEPOINT_RIGHT, BlzFrameGetHeight(button) * (id - 1), 0)

            local buttonTexture = BlzGetFrameByName("MyButtonBackdropTemplate", 0)
            BlzFrameSetTexture(buttonTexture, BlzGetAbilityIcon(FourCC(ability.id)), 0, true)
            local trig = CreateTrigger()
            BlzTriggerRegisterFrameEvent(trig, buttonAbility, FRAMEEVENT_CONTROL_CLICK)
            TriggerAddAction(trig, function()
                if ability.active == true or ability.active == nil then
                    ability.active = false
                    BlzFrameSetTexture(buttonTexture, replaceTexture(BlzGetAbilityIcon(FourCC(ability.id))), 0, true)
                    SetPlayerAbilityAvailable(player.spawnPlayerId, FourCC(ability.id), false)
                else
                    ability.active = true
                    BlzFrameSetTexture(buttonTexture, BlzGetAbilityIcon(FourCC(ability.id)), 0, true)
                    SetPlayerAbilityAvailable(player.spawnPlayerId, FourCC(ability.id), true)
                end
            end)
        end
        return true
    end
    return false
end

Debug.endFile()
Debug.beginFile('finish-game.lua')
function finishGame(loseTeam)
    local mainBackdrop = BlzCreateFrame('FinishGameBackdrop', BlzGetFrameByName("ConsoleUIBackdrop", 0), 0, 0)
    BlzFrameSetAbsPoint(mainBackdrop, FRAMEPOINT_CENTER, 0.4, 0.35)
    BlzFrameSetLevel(mainBackdrop, 99)

    local weightMultiplyForBigFont = 1.5
    local heightFont = 0.02

    local fakeText = BlzCreateFrame("HeaderTableText", mainBackdrop, 0, 0)
    BlzFrameSetSize(fakeText, 0.15, 0.01)
    BlzFrameSetText(fakeText, '')
    BlzFrameSetPoint(fakeText, FRAMEPOINT_TOPLEFT, mainBackdrop, FRAMEPOINT_TOPLEFT, 0.02, -0.01)

    local firstColumn = fakeText
    local prevColumn = fakeText
    local totalWidth
    local totalRows = 4
    for teamNumber, team in ipairs(all_teams) do
        totalWidth = 0
        local tableInfo = getTableInfo(teamNumber)

        local teamLabel = BlzCreateFrame("HeaderTableText", mainBackdrop, 0, 0)
        BlzFrameSetSize(teamLabel, 0.15, 0.02)
        BlzFrameSetText(teamLabel, 'Team ' .. teamNumber)
        BlzFrameSetPoint(teamLabel, FRAMEPOINT_TOP, firstColumn, FRAMEPOINT_BOTTOM, 0, 0)
        firstColumn = teamLabel
        prevColumn = teamLabel

        for i, headerColumn in ipairs(tableInfo.header) do
            if headerColumn.text and headerColumn.isFinish then
                local header = BlzCreateFrame("HeaderTableText", mainBackdrop, 0, 0)
                BlzFrameSetSize(header, headerColumn.weight * weightMultiplyForBigFont, heightFont)
                totalWidth = totalWidth + (headerColumn.weight * weightMultiplyForBigFont)
                BlzFrameSetText(header, headerColumn.text)
                BlzFrameSetTextAlignment(header, TEXT_JUSTIFY_TOP, TEXT_JUSTIFY_LEFT)
                if i == 1 then
                    BlzFrameSetPoint(header, FRAMEPOINT_TOP, firstColumn, FRAMEPOINT_BOTTOM, 0, 0)
                    firstColumn = header
                else
                    BlzFrameSetPoint(header, FRAMEPOINT_TOPLEFT, prevColumn, FRAMEPOINT_TOPRIGHT, 0, 0)
                end
                prevColumn = header
            end
        end

        for _, row in ipairs(tableInfo.body) do
            local prevColumn
            totalRows = totalRows + 1
            for j, element in ipairs(row) do
                if element.text and tableInfo.header[j].isFinish then
                    local column = BlzCreateFrame("RowTableText", mainBackdrop, 0, 0)
                    if j == 1 then
                        local line = BlzCreateSimpleFrame("FinishGameLine", mainBackdrop, 0)
                        BlzFrameSetPoint(line, FRAMEPOINT_BOTTOMLEFT, column, FRAMEPOINT_BOTTOMLEFT, -0.005, 0.005)
                        BlzFrameSetSize(line,totalWidth, 0.015)
                        BlzFrameSetAlpha(line, 50)

                        local texture = BlzGetFrameByName("FinishGameLineTexture", 0)
                        BlzFrameSetTexture(texture, "war3mapImported\\line.tga", 0, true)
                        BlzFrameSetVertexColor(texture, element.integerColor)
                    end
                    BlzFrameSetSize(column, tableInfo.header[j].weight * weightMultiplyForBigFont, heightFont)
                    BlzFrameSetTextAlignment(column, TEXT_JUSTIFY_TOP, TEXT_JUSTIFY_LEFT)
                    BlzFrameSetTextColor(column, element.integerColor)
                    BlzFrameSetText(column, element.text)
                    if j == 1 then
                        BlzFrameSetPoint(column, FRAMEPOINT_TOP, firstColumn, FRAMEPOINT_BOTTOM, 0, 0)
                        firstColumn = column
                    else
                        BlzFrameSetPoint(column, FRAMEPOINT_TOPLEFT, prevColumn, FRAMEPOINT_TOPRIGHT, 0, 0)
                    end
                    prevColumn = column
                end
                if element.icon then
                    local frame = BlzCreateFrameByType("BACKDROP", "Any", mainBackdrop, "", 0)
                    BlzFrameSetSize(frame, heightFont, heightFont)
                    BlzFrameSetTexture(frame, element.icon, 0, true)
                    if j == 1 then
                        BlzFrameSetPoint(frame, FRAMEPOINT_TOP, firstColumn, FRAMEPOINT_BOTTOM, 0, 0)
                        firstColumn = column
                    else
                        BlzFrameSetPoint(frame, FRAMEPOINT_TOPLEFT, prevColumn, FRAMEPOINT_TOPRIGHT, 0, 0)
                    end
                    prevColumn = frame
                end
            end
        end
    end

    local mainButton = BlzCreateFrame("ScriptDialogButton", mainBackdrop, 0, 0)
    local buttonText = BlzGetFrameByName("ScriptDialogButtonText", 0)
    BlzFrameSetSize(mainButton, 0.15, 0.04)
    BlzFrameSetPoint(mainButton, FRAMEPOINT_BOTTOMRIGHT, mainBackdrop, FRAMEPOINT_BOTTOMRIGHT, -0.01, 0.01)
    BlzFrameSetText(buttonText, "Exit")
    local trig = CreateTrigger()
    BlzTriggerRegisterFrameEvent(trig, mainButton, FRAMEEVENT_CONTROL_CLICK)
    TriggerAddAction(trig, function()
        CustomVictoryBJ(GetTriggerPlayer(), false, true)
    end)

    local victoryOrLosePict = BlzCreateFrameByType("BACKDROP", "Any", mainBackdrop, "", 0)
    BlzFrameSetSize(victoryOrLosePict, 0.14, 0.14)

    if isPlayerIsWinner(loseTeam) then
        BlzFrameSetTexture(victoryOrLosePict, "war3mapImported\\victory1.blp", 0, true)
    else
        BlzFrameSetTexture(victoryOrLosePict, "war3mapImported\\defeat1.blp", 0, true)
    end

    BlzFrameSetPoint(victoryOrLosePict, FRAMEPOINT_BOTTOM, mainButton, FRAMEPOINT_TOP, 0, 0.001)
    BlzFrameSetSize(mainBackdrop, totalWidth + 0.18, 0.35)
end

function isPlayerIsWinner(loseTeam)
    localPlayer = GetLocalPlayer()
    for _, player in ipairs(loseTeam.players) do
        if localPlayer == player.id then
            return false
        end
    end
    return true
end
Debug.endFile()
Debug.beginFile('hero-statistic-panel.lua')

function heroStatisticPanel()
    local tableInfo = getHeroInfo()
    heroMultiboard = CreateMultiboardBJ( #tableInfo.header, 1, "Heroes statistics" )
    heroMultiboardFrame = BlzGetFrameByName("Multiboard",0)
    heroMultiContainer = BlzGetFrameByName("MultiboardListContainer",0)
    heroMultiBackdrop = BlzGetFrameByName("MultiboardBackdrop",0)
    for i, header in ipairs(tableInfo.header) do
        local title = MultiboardGetItem(heroMultiboard, 0, i - 1)
        if header.text ~= nil then
            MultiboardSetItemStyle(title, true, false)
            MultiboardSetItemValue(title, header.text)
            MultiboardSetItemWidth(title, header.weight)
        else
            MultiboardSetItemStyle(title, false, false)
            MultiboardSetItemWidth(title, 0.0001)
        end
        MultiboardReleaseItem(title)
    end

    BlzFrameClearAllPoints(heroMultiboardFrame)
    BlzFrameSetAbsPoint(heroMultiboardFrame, FRAMEPOINT_LEFT, 0.19,0.55)
    BlzFrameSetVisible(heroMultiboardFrame, true)
    MultiboardMinimize(heroMultiboard, true)
end

function updateStatisticPanel()
    local updatedTableInfo = getHeroInfo()


    local function compareRows(row1, row2)
        return row1[5].text > row2[5].text
    end
    table.sort(updatedTableInfo.body, compareRows)

    MultiboardSetRowCount(heroMultiboard,  #updatedTableInfo.body + 1)
    for row, bodyRow in ipairs(updatedTableInfo.body) do
        for col, cell in ipairs(bodyRow) do

            local item = MultiboardGetItem(heroMultiboard, row, col - 1)

            if (col == 1) then
                MultiboardSetItemStyle(item, true, false)
                MultiboardSetItemValue(item, row)
                MultiboardSetItemWidth(item, updatedTableInfo.header[col].weight)
            elseif (cell.text) then
                MultiboardSetItemStyle(item, true, false)
                MultiboardSetItemValue(item, cell.text)
                MultiboardSetItemValueColor(item, cell.color.r, cell.color.g, cell.color.b, cell.color.t)
                MultiboardSetItemWidth(item, updatedTableInfo.header[col].weight)
            elseif (cell.icon) then
                MultiboardSetItemStyle(item, false, true)
                MultiboardSetItemIcon(item, cell.icon)
                MultiboardSetItemWidth(item, 0.01)
            else
                MultiboardSetItemStyle(item, true, false)
                MultiboardSetItemValue(item, "")
                MultiboardSetItemWidth(item, 0.01)
            end
            MultiboardReleaseItem(item)
        end
    end
end

function getHeroInfo()
    local tableInfo = {}
    tableInfo.header = {}
    table.insert(tableInfo.header, { text = 'P', weight = 0.015})
    table.insert(tableInfo.header, { text = '  ', weight = 0.015})
    table.insert(tableInfo.header, { text = 'Name', weight = 0.09})
    table.insert(tableInfo.header, { text = 'Kills', weight = 0.03})
    table.insert(tableInfo.header, { text = 'Damage', weight = 0.05})
    tableInfo.body = {}
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            for _, hero in ipairs(player.heroes) do
                if hero.damage >= 1 then
                    local row = {}
                    table.insert(row, {})
                    table.insert(row, {
                        icon = hero.icon,
                        color = player.color,
                        integerColor = player.integerColor,
                        isSensitive = false
                    })
                    table.insert(row, {
                        text = hero.name,
                        color = player.color,
                        integerColor = player.integerColor,
                        isSensitive = false
                    })
                    table.insert(row, {
                        text = hero.kills,
                        color = player.color,
                        integerColor = player.integerColor,
                        isSensitive = false
                    })
                    table.insert(row, {
                        text = hero.damage,
                        color = player.color,
                        integerColor = player.integerColor,
                        isSensitive = false
                    })
                    table.insert(tableInfo.body, row)
                end
            end
        end
    end
    return tableInfo
end
Debug.endFile()
Debug.beginFile('element-check-box.lua')
function createCheckBox(parentPage, lastElement, element)

    local label = BlzCreateFrameByType("TEXT", "", parentPage, "EscMenuSaveDialogTextTemplate", 0)
    BlzFrameSetText(label, element.text)
    BlzFrameSetSize(label, ui_params.lengthString, ui_params.widthString)
    BlzFrameSetEnable(label, GetLocalPlayer() == getMainPlayer())
    BlzFrameSetPoint(label, FRAMEPOINT_TOPLEFT, lastElement, FRAMEPOINT_TOPLEFT, 0, -ui_params.betweenElement)

    local tooltipFrame, tooltipLabel = createTooltip(parentPage)
    BlzFrameSetTooltip(label, tooltipFrame)
    BlzFrameSetText(tooltipLabel, element.tooltip)

    local frameCheckBox = BlzCreateFrame("QuestCheckBox2", parentPage, 0, 0)
    BlzFrameSetPoint(frameCheckBox, FRAMEPOINT_LEFT, label, FRAMEPOINT_RIGHT, 0, 0)
    BlzFrameSetScale(frameCheckBox, 1.5)
    BlzFrameSetEnable(frameCheckBox, GetLocalPlayer() == getMainPlayer())

    local trigger = CreateTrigger()
    BlzTriggerRegisterFrameEvent(trigger, frameCheckBox, FRAMEEVENT_CHECKBOX_CHECKED)
    BlzTriggerRegisterFrameEvent(trigger, frameCheckBox, FRAMEEVENT_CHECKBOX_UNCHECKED)
    TriggerAddAction(trigger, function()
        if BlzGetTriggerFrameEvent() == FRAMEEVENT_CHECKBOX_CHECKED then
            element.value = true
        else
            element.value = false
        end
    end)
    return label
end
Debug.endFile()
Debug.beginFile('element-check-box.lua')
function createEditBox(parentPage, lastElement, element)
    local frameText = BlzCreateFrameByType("TEXT", "TextFrame", parentPage, "EscMenuSaveDialogTextTemplate", 0)
    BlzFrameSetText(frameText, element.text)
    BlzFrameSetSize(frameText, ui_params.lengthString, ui_params.widthString)
    BlzFrameSetEnable(frameText, GetLocalPlayer() == getMainPlayer())
    BlzFrameSetPoint(frameText, FRAMEPOINT_TOPLEFT, lastElement, FRAMEPOINT_TOPLEFT, 0, -ui_params.betweenElement)

    local tooltipFrame, tooltipLabel = createTooltip(parentPage)
    BlzFrameSetTooltip(frameText, tooltipFrame)
    BlzFrameSetText(tooltipLabel, element.tooltip)

    local editBox = BlzCreateFrame("EscMenuEditBoxTemplate", parentPage, 0, 0) --create the box
    BlzFrameSetPoint(editBox, FRAMEPOINT_LEFT, frameText, FRAMEPOINT_RIGHT, 0, 0)
    BlzFrameSetSize(editBox, 0.1, 0.03)
    BlzFrameSetText(editBox, element.defValue)
    BlzFrameSetEnable(editBox, GetLocalPlayer() == getMainPlayer())

    local label = BlzCreateFrame("EscMenuLabelTextTemplate", parentPage, 0, 0)
    BlzFrameSetPoint(label, FRAMEPOINT_LEFT, editBox, FRAMEPOINT_RIGHT, 0, 0)
    BlzFrameSetText(label, '= ' .. element.defValue)
    BlzFrameSetEnable(label, GetLocalPlayer() == getMainPlayer())

    local trig = CreateTrigger()
    BlzTriggerRegisterFrameEvent(trig, editBox, FRAMEEVENT_EDITBOX_ENTER)
    TriggerAddAction(trig, function()
        local value = extractNumber(BlzGetTriggerFrameText())

        local newValue
        if value ~= nil then
            if value <= element.min then
                newValue = element.min
            elseif value >= element.max then
                newValue = element.max
            else
                newValue = value
            end
        else
            newValue = initValue
        end

        if (newValue ~= nil) then
            element.value = value
            BlzFrameSetText(label, '= ' .. newValue)
        end
    end)
    return frameText
end

function extractNumber(inputString)
    local number = string.match(inputString, "%-?%d+")
    return number and tonumber(number) or nil
end
Debug.endFile()

Debug.beginFile('element-slider.lua')
function createSlider(parentPage, lastElement, element)
    local frameText = BlzCreateFrameByType("TEXT", "TextCountHeroes", parentPage, "EscMenuSaveDialogTextTemplate", 0)
    BlzFrameSetText(frameText, element.text)
    BlzFrameSetSize(frameText, ui_params.lengthString, ui_params.widthString)
    BlzFrameSetEnable(frameText, GetLocalPlayer() == getMainPlayer())
    BlzFrameSetPoint(frameText, FRAMEPOINT_TOPLEFT, lastElement, FRAMEPOINT_TOPLEFT, 0, -ui_params.betweenElement)

    local tooltipFrame, tooltipLabel = createTooltip(parentPage)
    BlzFrameSetTooltip(frameText, tooltipFrame)
    BlzFrameSetText(tooltipLabel, element.tooltip)

    local slider = BlzCreateFrame("EscMenuSliderTemplate", parentPage, 0, 0)
    BlzFrameSetPoint(slider, FRAMEPOINT_LEFT, frameText, FRAMEPOINT_RIGHT, 0, 0)
    BlzFrameSetMinMaxValue(slider, element.min, element.max)
    BlzFrameSetValue(slider, element.defValue)
    BlzFrameSetStepSize(slider, element.step)
    BlzFrameSetEnable(slider, GetLocalPlayer() == getMainPlayer())

    local label = BlzCreateFrame("EscMenuLabelTextTemplate", slider, 0, 0)
    BlzFrameSetPoint(label, FRAMEPOINT_LEFT, slider, FRAMEPOINT_RIGHT, 0, 0)
    BlzFrameSetText(label, element.defValue)
    BlzFrameSetEnable(label, GetLocalPlayer() == getMainPlayer())

    local sliderTrigger = CreateTrigger()
    BlzTriggerRegisterFrameEvent(sliderTrigger, slider, FRAMEEVENT_SLIDER_VALUE_CHANGED)
    TriggerAddAction(sliderTrigger, function()
        local value = BlzGetTriggerFrameValue()
        element.value = value
        BlzFrameSetText(label, math.floor(value))
    end)
    return frameText
end
Debug.endFile()
Debug.beginFile('init-start-game-ui.lua')
function initStartGameUI()
    ui_params = {
        lengthString = 0.2,
        widthString = 0.02,
        indent = 0.015,
        width = 0.4,
        betweenElement = 0.029
    }

    elementType = {
        SLIDER = 'slider',
        EDIT_BOX = 'editBox',
        CHECK_BOX = 'checkBox'
    }

    page = {
        GENERAL = 'general',
        ECONOMY = 'economy',
        HEROES = 'heroes',
        UNITS = 'units'
    }

    ui_elements = {
        -- GENERAL
        {
            page = page.GENERAL,
            type = elementType.SLIDER,
            text = 'Wave interval each players',
            tooltip = 'Wave release interval between players. The total interval for each player between their' ..
                    ' turns will be the product of the number of players and the interval.\n\nThe default value of this' ..
                    ' parameter varies depending on the number of players:\n' ..
                    '[1x1] 35 sec * 1 = 35 total\n' ..
                    '[2x2] 35 sec * 2 = 70 total\n' ..
                    '[3x3] 35 sec * 3 = 105 total\n' ..
                    '[4x4] 30 sec * 4 = 120 total\n' ..
                    '[5x5] 25 sec * 4 = 125 total\n',
            defValue = {
                [1] = 35,
                [2] = 35,
                [3] = 35,
                [4] = 35,
                [5] = 35,
                [6] = 35,
                [7] = 30,
                [8] = 30,
                [9] = 25,
                [10] = 25
            },
            max = 120,
            min = 1,
            step = 1,
            initConfigValue = function(self)
                game_config.spawnPolicy.interval = self.value
            end
        },
        {
            page = page.GENERAL,
            type = elementType.SLIDER,
            text = 'Wave interval all players',
            tooltip = 'The interval for the next wave after all players have launched waves and a full cycle has passed for the team',
            defValue = 0,
            max = 120,
            min = 0,
            step = 1,
            initConfigValue = function(self)
                game_config.spawnPolicy.dif = self.value
            end
        },
        {
            page = page.GENERAL,
            type = elementType.EDIT_BOX,
            text = 'Base HP',
            tooltip = "Maximum health capacity of the team's main base",
            defValue = 4000,
            max = 999999,
            min = 1,
            step = 1,
            initConfigValue = function(self)
                game_config.units.baseHP = self.value
            end
        },
        {
            page = page.GENERAL,
            type = elementType.EDIT_BOX,
            text = 'Tower HP',
            tooltip = "Maximum health capacity of the team's tower",
            defValue = 4000,
            max = 999999,
            min = 1,
            step = 1,
            initConfigValue = function(self)
                game_config.units.towerHP = self.value
            end
        },
        -- ECONOMY
        {
            page = page.ECONOMY,
            type = elementType.EDIT_BOX,
            text = 'Start gold',
            tooltip = "Initial amount of gold with which players start the game",
            defValue = 300,
            max = 999999,
            min = 0,
            step = 1,
            initConfigValue = function(self)
                game_config.economy.startGold = self.value
            end
        },
        {
            page = page.ECONOMY,
            type = elementType.SLIDER,
            text = 'Base income/min',
            tooltip = "Starting amount of income",
            defValue = 300,
            max = 3000,
            min = 0,
            step = 30,
            initConfigValue = function(self)
                game_config.economy.startIncomePerSec = self.value
            end
        },
        {
            page = page.ECONOMY,
            type = elementType.SLIDER,
            text = 'Added inc for each mine',
            tooltip = "Additional income awarded to the player for each mine upgrade",
            defValue = 30,
            max = 300,
            min = 30,
            step = 30,
            initConfigValue = function(self)
                game_config.economy.incomeBoost = self.value
            end
        },
        {
            page = page.ECONOMY,
            type = elementType.SLIDER,
            text = 'Added inc for controlling center',
            tooltip = "Additional income for team control of the center.\nThis income is granted to the team that" ..
                    " first crosses the center of the map, until another team crosses the center",
            defValue = 30,
            max = 300,
            min = 0,
            step = 30,
            initConfigValue = function(self)
                game_config.economy.incomeForCenter = self.value
            end
        },
        {
            page = page.ECONOMY,
            type = elementType.SLIDER,
            text = 'Price first mine',
            tooltip = "Cost of the first upgrade for the mine",
            defValue = 150,
            max = 1500,
            min = 1,
            step = 1,
            initConfigValue = function(self)
                game_config.economy.firstMinePrice = self.value
            end
        },
        {
            page = page.ECONOMY,
            type = elementType.SLIDER,
            text = 'Price diff for each next mine',
            tooltip = "Price increase for each subsequent mine upgrade",
            defValue = 75,
            max = 300,
            min = 1,
            step = 1,
            initConfigValue = function(self)
                game_config.economy.nextMineDiffPrice = self.value
            end
        },
        {
            page = page.ECONOMY,
            type = elementType.SLIDER,
            text = 'Gold for killing the tower',
            tooltip = "Amount of gold awarded to each team member for destroying an enemy tower",
            defValue = 125,
            max = 1500,
            min = 0,
            step = 1,
            initConfigValue = function(self)
                game_config.economy.goldByTower = self.value
            end
        },
        {
            page = page.ECONOMY,
            type = elementType.SLIDER,
            text = 'Gold for killing units',
            tooltip = "Amount of gold earned for killing enemy units, calculated as a percentage of their cost. \n" ..
                    "For example, if the parameter value is 10%, the player receives 10% of the cost of the defeated unit. \n"..
                    "Players do not receive gold for killing summoned units",
            defValue = 0,
            max = 100,
            min = 0,
            step = 1,
            initConfigValue = function(self)
                game_config.economy.goldForKill = self.value
            end
        },
        {
            page = page.ECONOMY,
            type = elementType.CHECK_BOX,
            text = 'Upkeep',
            tooltip = "No Upkeep (0-50 Food: 100% income)\n" ..
                    "Low Upkeep (51-100 Food: 80% income)\n" ..
                    "High Upkeep (101+ Food: 60% income)",
            defValue = false,
            initConfigValue = function(self)
                game_config.economy.upkeep = self.value
            end
        },
        -- UNITS
        {
            page = page.UNITS,
            type = elementType.CHECK_BOX,
            text = 'Mirror units',
            tooltip = "Distribute identical random units to players of opposing teams in corresponding positions.\n" ..
                    "For example, player 1 from team 1 will have the same set of units as player 1 from team 2, and so on",
            defValue = false,
            initConfigValue = function(self)
                game_config.units.isUnitsMirror = self.value
            end
        },
        {
            page = page.UNITS,
            type = elementType.SLIDER,
            text = 'Max lifespan of unit in waves',
            tooltip = "Number of waves after a unit's deployment, upon which the unit will disappear.\n" ..
                    "For example, if the parameter value is 2, then the unit will vanish after two more waves are" ..
                    " released by the player who owns that unit.",
            defValue = 2,
            max = 15,
            min = 1,
            step = 1,
            initConfigValue = function(self)
                game_config.units.lifetime = self.value
            end
        },
        -- HEROES
        {
            page = page.HEROES,
            type = elementType.CHECK_BOX,
            text = 'Mirror heroes',
            tooltip = "Assign identical random heroes to players of opposing teams in the same positions.\n" ..
                    "For instance, player 1 from team 1 will have the same hero as player 1 from team 2, and so forth",
            defValue = false,
            initConfigValue = function(self)
                game_config.units.isHeroesMirror = self.value
            end
        },
        {
            page = page.HEROES,
            type = elementType.SLIDER,
            text = 'Max heroes',
            tooltip = "Maximum possible number of heroes for each player",
            defValue = 3,
            max = 7,
            min = 0,
            step = 1,
            initConfigValue = function(self)
                game_config.units.maxHeroes = self.value
            end
        },
        {
            page = page.HEROES,
            type = elementType.SLIDER,
            text = 'Selectable hero count',
            tooltip = "Number of random heroes available for a player to choose from when summoning each subsequent hero.\n"
            .. " For example, if the parameter value is 3, then upon constructing a hero, the player will have a " ..
                    "choice among 3 randomly generated hero options.",
            defValue = 2,
            max = 11,
            min = 1,
            step = 1,
            initConfigValue = function(self)
                game_config.units.countForSelect = self.value
            end
        },
        {
            page = page.HEROES,
            type = elementType.SLIDER,
            text = 'Item capacity',
            tooltip = "Maximum number of items that a hero can carry",
            defValue = 4,
            max = 6,
            min = 0,
            step = 1,
            initConfigValue = function(self)
                game_config.units.itemCapacity = self.value
            end
        },
        {
            page = page.HEROES,
            type = elementType.SLIDER,
            text = 'Start hero level',
            tooltip = "The initial level of the hero after construction.",
            defValue = 1,
            max = 10,
            min = 1,
            step = 1,
            initConfigValue = function(self)
                game_config.units.heroStartLevel = self.value
            end
        }
    }
end
Debug.endFile()
Debug.beginFile('main-start-game.lua')
function startGameUI()
    BlzLoadTOCFile("war3mapimported\\templates.toc")

    local upkeepFrame = BlzGetFrameByName("ResourceBarUpkeepText", 0)
    BlzFrameSetText(upkeepFrame, "alga")

    local parent = BlzCreateFrame("GreenText", BlzGetFrameByName("ConsoleUIBackdrop", 0), 0, 0)
    BlzFrameSetParent(parent, preConfigGameModes)
    BlzFrameSetText(parent, GetPlayerName(getMainPlayer()) .. " is selecting...")
    BlzFrameSetAbsPoint(parent, FRAMEPOINT_CENTER, 0.4, 0.56)
    BlzFrameSetSize(parent, ui_params.width, 0.02)

    local allPages = {}
    local buttonGeneral, pageGeneral, lastElementGeneral = configPage("General", parent, allPages, 0.02)
    BlzFrameSetPoint(buttonGeneral, FRAMEPOINT_TOPLEFT, parent, FRAMEPOINT_BOTTOMLEFT, 0, 0)

    local buttonEconomy, pageEconomy, lastElementEconomy = configPage("Economy", parent, allPages, 0.02)
    BlzFrameSetPoint(buttonEconomy, FRAMEPOINT_LEFT, buttonGeneral, FRAMEPOINT_RIGHT, -0.005, 0)

    local buttonUnits, pageUnits, lastElementUnits = configPage("Units", parent, allPages, 0.13)
    BlzFrameSetPoint(buttonUnits, FRAMEPOINT_LEFT, buttonEconomy, FRAMEPOINT_RIGHT, -0.005, 0)
    local availableUnitsTextFrame = BlzCreateFrameByType('TEXT', 'availableUnitsTextFrame', pageUnits, 'EscMenuSaveDialogTextTemplate', 0)
    BlzFrameSetText(availableUnitsTextFrame, 'Available units:')
    BlzFrameSetPoint(availableUnitsTextFrame, FRAMEPOINT_TOPLEFT, pageUnits, FRAMEPOINT_TOPLEFT, ui_params.indent, -0.04)
    for i, race in ipairs(main_race) do
        initRaceAvailableButton(race, i, availableUnitsTextFrame, units_for_build, 5)
    end
    for _, unit in ipairs(units_for_build) do
        initUnitAvailableButton(unit, availableUnitsTextFrame)
    end

    local buttonHeroes, pageHeroes, lastElementHeroes = configPage("Heroes", parent, allPages, 0.16)
    BlzFrameSetPoint(buttonHeroes, FRAMEPOINT_LEFT, buttonUnits, FRAMEPOINT_RIGHT, -0.005, 0)
    local availableHeroesTextFrame = BlzCreateFrameByType('TEXT', 'availableHeroesTextFrame', pageHeroes, 'EscMenuSaveDialogTextTemplate', 0)
    BlzFrameSetText(availableHeroesTextFrame, 'Available heroes:')
    BlzFrameSetPoint(availableHeroesTextFrame, FRAMEPOINT_TOPLEFT, pageHeroes, FRAMEPOINT_TOPLEFT, ui_params.indent, -0.04)
    for i, race in ipairs(main_race) do
        initRaceAvailableButton(race, i, availableHeroesTextFrame, heroes_for_build, 6)
    end
    for _, hero in ipairs(heroes_for_build) do
        initUnitAvailableButton(hero, availableHeroesTextFrame)
    end

    initGameConfig()

    for _, element in ipairs(ui_elements) do
        if type(element.defValue) == 'table' then
            element.defValue = element.defValue[game_config.playersCount]
        end


        element.value = element.defValue


        if element.page == page.GENERAL then
            lastElementGeneral = createElement(element, pageGeneral, lastElementGeneral)
        elseif element.page == page.ECONOMY then
            lastElementEconomy = createElement(element, pageEconomy, lastElementEconomy)
        elseif element.page == page.UNITS then
            lastElementUnits = createElement(element, pageUnits, lastElementUnits)
        elseif element.page == page.HEROES then
            lastElementHeroes = createElement(element, pageHeroes, lastElementHeroes)
        end
    end

    for number, page in ipairs(allPages) do
        if number == 1 then
            BlzFrameSetVisible(page, true)
        else
            BlzFrameSetVisible(page, false)
        end
    end
    local startGameButton = BlzCreateFrame('StartGameButton', parent, 0, 0)
    BlzFrameSetLevel(startGameButton, 99)
    BlzFrameSetText(startGameButton, 'START')
    BlzFrameSetPoint(startGameButton, FRAMEPOINT_BOTTOMRIGHT, pageGeneral, FRAMEPOINT_BOTTOMRIGHT, -ui_params.indent, ui_params.indent)
    BlzFrameSetEnable(startGameButton, GetLocalPlayer() == getMainPlayer())
    BlzFrameSetEnable(startGameButton, GetLocalPlayer() == getMainPlayer())
    local trig1 = CreateTrigger()
    BlzTriggerRegisterFrameEvent(trig1, startGameButton, FRAMEEVENT_CONTROL_CLICK)
    TriggerAddAction(trig1, function()
        BlzFrameSetVisible(parent, FALSE)
        for _, element in ipairs(ui_elements) do
            element.initConfigValue(element)
        end
        startGame()
    end)
end

function createTooltip(owner)
    local tooltipFrame = BlzCreateFrame('TooltipBackdrop', owner, 0, 0)
    BlzFrameSetPoint(tooltipFrame, FRAMEPOINT_LEFT, owner, FRAMEPOINT_RIGHT, 0, 0)
    BlzFrameSetSize(tooltipFrame, 0.26, 0.26)
    local tooltipLabel = BlzCreateFrameByType("TEXT", "", tooltipFrame, "EscMenuSaveDialogTextTemplate", 0)
    BlzFrameSetSize(tooltipLabel, 0.24, 0.24)
    BlzFrameSetTextAlignment(tooltipLabel, TEXT_JUSTIFY_MIDDLE, TEXT_JUSTIFY_MIDDLE)
    BlzFrameSetPoint(tooltipLabel, FRAMEPOINT_CENTER, tooltipFrame, FRAMEPOINT_CENTER, 0, 0)
    BlzFrameSetParent(tooltipLabel, tooltipFrame)
    return tooltipFrame, tooltipLabel
end

function createElement(element, page, lastElement)
    if element.type == elementType.SLIDER then
        return createSlider(page, lastElement, element)
    elseif element.type == elementType.EDIT_BOX then
        return createEditBox(page, lastElement, element)
    elseif element.type == elementType.CHECK_BOX then
        return createCheckBox(page, lastElement, element)
    end

end

function buttonWithAction(text, parentFrame, action)
    local button = BlzCreateFrame('Button', parentFrame, 0, 0)
    BlzFrameSetLevel(button, 99)
    BlzFrameSetText(button, text)
    BlzFrameSetEnable(button, GetLocalPlayer() == getMainPlayer())
    local trig = CreateTrigger()
    BlzTriggerRegisterFrameEvent(trig, button, FRAMEEVENT_CONTROL_CLICK)
    TriggerAddAction(trig, action)
    return button
end

function configPage(text, parent, allPages, dif)
    local configButton = BlzCreateFrame('ConfigPageButton', parent, 0, 0)
    BlzFrameSetLevel(configButton, 99)
    BlzFrameSetText(configButton, text)
    BlzFrameSetEnable(configButton, GetLocalPlayer() == getMainPlayer())

    local pageFrame = BlzCreateFrame('ConfigPageBackdrop', parent, 0, 0)
    BlzFrameSetPoint(pageFrame, FRAMEPOINT_TOP, parent, FRAMEPOINT_BOTTOM, 0, 0)
    BlzFrameSetSize(pageFrame, ui_params.width, 0.4)
    BlzFrameSetEnable(pageFrame, GetLocalPlayer() == getMainPlayer())
    table.insert(allPages, pageFrame)

    local emptyFrame = BlzCreateFrameByType("FRAME", "", parent, "", 0)
    BlzFrameSetSize(emptyFrame, ui_params.lengthString, 0.001)

    BlzFrameSetPoint(emptyFrame, FRAMEPOINT_TOPLEFT, pageFrame, FRAMEPOINT_TOPLEFT, ui_params.indent, -dif)

    local trig = CreateTrigger()
    BlzTriggerRegisterFrameEvent(trig, configButton, FRAMEEVENT_CONTROL_CLICK)
    TriggerAddAction(trig, function()
        for _, page in ipairs(allPages) do
            BlzFrameSetVisible(page, false)
        end
        BlzFrameSetVisible(pageFrame, true)
    end)
    return configButton, pageFrame, emptyFrame
end

function initRaceAvailableButton(race, position, frame, unitContainer, max)
    if position >= max then
        return
    end
    local button = BlzCreateFrame("MyIconButtonTemplate", frame, 0, 0)
    BlzFrameSetPoint(button, FRAMEPOINT_TOPLEFT, frame, FRAMEPOINT_TOPLEFT, 0, -(BlzFrameGetHeight(button) * position) + 0.01)

    local buttonTexture = BlzGetFrameByName("MyButtonBackdropTemplate", 0)
    BlzFrameSetTexture(buttonTexture, BlzGetAbilityIcon(FourCC(race.id)), 0, true)

    race.active = true
    local trig = CreateTrigger()
    BlzTriggerRegisterFrameEvent(trig, button, FRAMEEVENT_CONTROL_CLICK)
    TriggerAddAction(trig, function()
        if GetTriggerPlayer() ~= getMainPlayer() then
            return
        end
        if race.active == true then
            race.active = false
            BlzFrameSetTexture(buttonTexture, replaceTexture(BlzGetAbilityIcon(FourCC(race.id))), 0, true)
            for _, unit in ipairs(unitContainer) do
                if unit.race == race.race then
                    unit.active = false
                    BlzFrameSetTexture(unit.buttonTexture, replaceTexture(BlzGetAbilityIcon(FourCC(unit.parentId))), 0, true)
                end
            end
        else
            race.active = true
            BlzFrameSetTexture(buttonTexture, BlzGetAbilityIcon(FourCC(race.id)), 0, true)
            for _, unit in ipairs(unitContainer) do
                if unit.race == race.race then
                    unit.active = true
                    BlzFrameSetTexture(unit.buttonTexture, BlzGetAbilityIcon(FourCC(unit.parentId)), 0, true)
                end
            end
        end
    end)
end

function initUnitAvailableButton(unit, containerFrame)
    local button = BlzCreateFrame("MyIconButtonTemplate", containerFrame, 0, 0)
    BlzFrameSetPoint(button, FRAMEPOINT_TOPLEFT, containerFrame, FRAMEPOINT_TOPLEFT, (BlzFrameGetWidth(button) * unit.position), -(BlzFrameGetHeight(button) * unit.line) + 0.01)

    local buttonTexture = BlzGetFrameByName("MyButtonBackdropTemplate", 0)
    BlzFrameSetTexture(buttonTexture, BlzGetAbilityIcon(FourCC(unit.parentId)), 0, true)

    unit.active = true
    unit.buttonTexture = buttonTexture
    local trig = CreateTrigger()
    BlzTriggerRegisterFrameEvent(trig, button, FRAMEEVENT_CONTROL_CLICK)
    TriggerAddAction(trig, function()
        if GetTriggerPlayer() ~= getMainPlayer() then
            return
        end
        if unit.active == true then
            unit.active = false
            BlzFrameSetTexture(buttonTexture, replaceTexture(BlzGetAbilityIcon(FourCC(unit.parentId))), 0, true)
        else
            unit.active = true
            BlzFrameSetTexture(buttonTexture, BlzGetAbilityIcon(FourCC(unit.parentId)), 0, true)
        end
    end)
end

function replaceTexture(inputString)
    local replacedString = inputString:gsub("ReplaceableTextures\\CommandButtons\\(.-)%.blp", "ReplaceableTextures\\CommandButtonsDisabled\\DIS%1.blp")
    return replacedString
end
Debug.endFile()
Debug.beginFile('status-panel.lua')
function getTableInfo(teamId)
    local tableInfo = {}
    tableInfo.header = {}
    table.insert(tableInfo.header, { text = 'Name', weight = 0.085, isFinish = true })
    table.insert(tableInfo.header, { text = 'Wave', weight = 0.04 })
    table.insert(tableInfo.header, { text = 'Inc/min', weight = 0.07 })
    table.insert(tableInfo.header, { text = 'Gold total', weight = 0.045, isFinish = true })

    if game_config.economy.goldForKill > 0 then
        table.insert(tableInfo.header, { text = 'Gold kill', weight = 0.045, isFinish = true })
    end

    table.insert(tableInfo.header, { text = 'Kills', weight = 0.05, isFinish = true })
    table.insert(tableInfo.header, { text = 'Damage', weight = 0.06, isFinish = true })
    table.insert(tableInfo.header, { text = 'Tier', weight = 0.04, isFinish = true })
    table.insert(tableInfo.header, { text = 'Army', weight = 0.04, isFinish = true })
    table.insert(tableInfo.header, { text = 'Heroes', weight = 0.06, isFinish = true })
    table.insert(tableInfo.header, { })
    table.insert(tableInfo.header, { })
    table.insert(tableInfo.header, { })
    table.insert(tableInfo.header, { })
    table.insert(tableInfo.header, { })
    table.insert(tableInfo.header, { })
    tableInfo.body = {}

    local teams
    if teamId then
        teams = { all_teams[teamId] }
    else
        teams = all_teams
    end

    for _, team in ipairs(teams) do
        for _, player in ipairs(team.players) do
            local row = {}
            table.insert(row, {
                text = getClearName(player),
                color = player.color,
                integerColor = player.integerColor,
                isSensitive = false
            })
            table.insert(row, {
                text = math.floor(player.spawnTimer),
                color = player.color,
                integerColor = player.integerColor,
                isSensitive = false
            })
            table.insert(row, {
                text = getIncome(player),
                color = player.color,
                integerColor = player.integerColor,
                isSensitive = true
            })
            table.insert(row, {
                text = player.economy.totalGold,
                color = player.color,
                integerColor = player.integerColor,
                isSensitive = true
            })

            if game_config.economy.goldForKill  > 0 then
                table.insert(row, {
                    text = player.economy.totalGoldForKills,
                    color = player.color,
                    integerColor = player.integerColor,
                    isSensitive = true
                })
            end

            table.insert(row, {
                text = player.totalKills,
                color = player.color,
                integerColor = player.integerColor,
                isSensitive = false
            })
            table.insert(row, {
                text = player.totalDamage,
                color = player.color,
                integerColor = player.integerColor,
                isSensitive = false
            })
            table.insert(row, {
                text = player.tier,
                color = player.color,
                integerColor = player.integerColor,
                isSensitive = true
            })
            table.insert(row, {
                text = player.food,
                color = player.color,
                integerColor = player.integerColor,
                isSensitive = true
            })
            table.insert(row, {
                icon = player.heroes[1] and player.heroes[1].icon or nil,
                color = player.color,
                integerColor = player.integerColor,
                isSensitive = true
            })
            table.insert(row, {
                icon = player.heroes[2] and player.heroes[2].icon or nil,
                color = player.color,
                integerColor = player.integerColor,
                isSensitive = true
            })
            table.insert(row, {
                icon = player.heroes[3] and player.heroes[3].icon or nil,
                color = player.color,
                integerColor = player.integerColor,
                isSensitive = true
            })
            table.insert(row, {
                icon = player.heroes[4] and player.heroes[4].icon or nil,
                color = player.color,
                integerColor = player.integerColor,
                isSensitive = true
            })
            table.insert(row, {
                icon = player.heroes[5] and player.heroes[5].icon or nil,
                color = player.color,
                integerColor = player.integerColor,
                isSensitive = true
            })
            table.insert(row, {
                icon = player.heroes[6] and player.heroes[6].icon or nil,
                color = player.color,
                integerColor = player.integerColor,
                isSensitive = true
            })
            table.insert(row, {
                icon = player.heroes[7] and player.heroes[7].icon or nil,
                color = player.color,
                integerColor = player.integerColor,
                isSensitive = true
            })
            table.insert(tableInfo.body, row)
        end
    end
    return tableInfo
end

function getIncome(player)
    if player.economy.incomeForCenter == 0 then
        return math.floor(player.economy.income)
    else
        return math.floor(player.economy.income) .. '(+' .. math.floor(player.economy.incomeForCenter) .. ')'
    end
end

function getClearName(player)
    return string.gsub(GetPlayerName(player.id), "#.*", "")
end

function updatePanelForAllPlayers()
    local updatedTableInfo = getTableInfo()
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            for row, bodyRow in ipairs(updatedTableInfo.body) do
                local isLocalPlayer = false
                local playerName = bodyRow[1].text
                for col, cell in ipairs(bodyRow) do

                    local title = 'Time: ' .. GetFormattedGameTime() .. '   Wave: ' .. math.floor(player.spawnTimer) .. '   Inc/min: ' .. getIncome(player) .. '   Kills: ' .. player.totalKills

                    local upkeep, _ = getUpkeepTypeAndPercent(player)

                    if upkeep then
                        local upkeepFrame = BlzGetFrameByName("ResourceBarUpkeepText", 0)
                        BlzFrameSetText(upkeepFrame, "alga")
                        local upkeepText
                        if upkeep == upkeepType.NO then
                            upkeepText = '  |cff00ff00No Upkeep|r'
                        elseif upkeep == upkeepType.LOW then
                            upkeepText = '  |cffffff00Low Upkeep(80)|r'
                        elseif upkeep == upkeepType.HIGH then
                            upkeepText = '  |cffff0000High Upkeep(60)|r'
                        end
                        title = title .. upkeepText

                    end

                    MultiboardSetTitleText(player.multiboard, title)

                    local item = MultiboardGetItem(player.multiboard, row, col - 1)
                    if isPlayerInTeam(playerName, team.players) then
                        isLocalPlayer = true
                    end

                    if (cell.text) then
                        MultiboardSetItemStyle(item, true, false)
                        if isLocalPlayer == true then
                            MultiboardSetItemValue(item, cell.text)
                        else
                            if cell.isSensitive == true then
                                MultiboardSetItemValue(item, "***")
                            else
                                MultiboardSetItemValue(item, cell.text)
                            end
                        end
                        MultiboardSetItemValueColor(item, cell.color.r, cell.color.g, cell.color.b, cell.color.t)
                        MultiboardSetItemWidth(item, updatedTableInfo.header[col].weight)
                    elseif (cell.icon) then
                        MultiboardSetItemStyle(item, false, true)
                        if isLocalPlayer == true then
                            MultiboardSetItemIcon(item, cell.icon)
                            MultiboardSetItemWidth(item, 0.01)
                        else
                            if cell.isSensitive == true then
                                MultiboardSetItemStyle(item, true, false)
                                MultiboardSetItemValue(item, "")
                                MultiboardSetItemWidth(item, 0.01)
                            else
                                MultiboardSetItemIcon(item, cell.icon)
                                MultiboardSetItemWidth(item, 0.01)
                            end
                        end
                    else
                        MultiboardSetItemStyle(item, true, false)
                        MultiboardSetItemValue(item, "")
                        MultiboardSetItemWidth(item, 0.01)
                    end
                    MultiboardReleaseItem(item)
                end
            end
        end
    end
end

function isPlayerInTeam(text, players)
    for _, player in ipairs(players) do
        if text == getClearName(player) then
            return true
        end
    end
    return false
end

function initPanelForAllPlayers()
    local tableInfo = getTableInfo()
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            player.multiboard = CreateMultiboardBJ( #tableInfo.header, #tableInfo.body + 1, "Board1" )
            local multiFrame = BlzGetFrameByName("Multiboard",0)
            player.multiFrame = multiFrame

            for i, header in ipairs(tableInfo.header) do
                local title = MultiboardGetItem(player.multiboard, 0, i - 1)
                if header.text ~= nil then
                    MultiboardSetItemStyle(title, true, false)
                    MultiboardSetItemValue(title, header.text)
                    MultiboardSetItemWidth(title, header.weight)

                else
                    MultiboardSetItemStyle(title, false, false)
                    MultiboardSetItemWidth(title, 0.0001)
                end
                MultiboardReleaseItem(title)
            end
        end
    end
    for _, team in ipairs(all_teams) do
        for _, player in ipairs(team.players) do
            if GetLocalPlayer() == player.id then
                BlzFrameSetVisible(player.multiFrame, true)
            end
        end
    end
end
Debug.endFile()


--CUSTOM_CODE
function InitCustomPlayerSlots()
SetPlayerStartLocation(Player(0), 0)
ForcePlayerStartLocation(Player(0), 0)
SetPlayerColor(Player(0), ConvertPlayerColor(0))
SetPlayerRacePreference(Player(0), RACE_PREF_HUMAN)
SetPlayerRaceSelectable(Player(0), false)
SetPlayerController(Player(0), MAP_CONTROL_USER)
SetPlayerStartLocation(Player(1), 1)
ForcePlayerStartLocation(Player(1), 1)
SetPlayerColor(Player(1), ConvertPlayerColor(1))
SetPlayerRacePreference(Player(1), RACE_PREF_ORC)
SetPlayerRaceSelectable(Player(1), false)
SetPlayerController(Player(1), MAP_CONTROL_USER)
SetPlayerStartLocation(Player(2), 2)
ForcePlayerStartLocation(Player(2), 2)
SetPlayerColor(Player(2), ConvertPlayerColor(2))
SetPlayerRacePreference(Player(2), RACE_PREF_HUMAN)
SetPlayerRaceSelectable(Player(2), false)
SetPlayerController(Player(2), MAP_CONTROL_USER)
SetPlayerStartLocation(Player(3), 3)
ForcePlayerStartLocation(Player(3), 3)
SetPlayerColor(Player(3), ConvertPlayerColor(3))
SetPlayerRacePreference(Player(3), RACE_PREF_HUMAN)
SetPlayerRaceSelectable(Player(3), false)
SetPlayerController(Player(3), MAP_CONTROL_USER)
SetPlayerStartLocation(Player(4), 4)
ForcePlayerStartLocation(Player(4), 4)
SetPlayerColor(Player(4), ConvertPlayerColor(4))
SetPlayerRacePreference(Player(4), RACE_PREF_HUMAN)
SetPlayerRaceSelectable(Player(4), false)
SetPlayerController(Player(4), MAP_CONTROL_USER)
SetPlayerStartLocation(Player(5), 5)
ForcePlayerStartLocation(Player(5), 5)
SetPlayerColor(Player(5), ConvertPlayerColor(5))
SetPlayerRacePreference(Player(5), RACE_PREF_HUMAN)
SetPlayerRaceSelectable(Player(5), false)
SetPlayerController(Player(5), MAP_CONTROL_USER)
SetPlayerStartLocation(Player(6), 6)
ForcePlayerStartLocation(Player(6), 6)
SetPlayerColor(Player(6), ConvertPlayerColor(6))
SetPlayerRacePreference(Player(6), RACE_PREF_HUMAN)
SetPlayerRaceSelectable(Player(6), false)
SetPlayerController(Player(6), MAP_CONTROL_USER)
SetPlayerStartLocation(Player(7), 7)
ForcePlayerStartLocation(Player(7), 7)
SetPlayerColor(Player(7), ConvertPlayerColor(7))
SetPlayerRacePreference(Player(7), RACE_PREF_HUMAN)
SetPlayerRaceSelectable(Player(7), false)
SetPlayerController(Player(7), MAP_CONTROL_USER)
SetPlayerStartLocation(Player(8), 8)
ForcePlayerStartLocation(Player(8), 8)
SetPlayerColor(Player(8), ConvertPlayerColor(8))
SetPlayerRacePreference(Player(8), RACE_PREF_HUMAN)
SetPlayerRaceSelectable(Player(8), false)
SetPlayerController(Player(8), MAP_CONTROL_USER)
SetPlayerStartLocation(Player(9), 9)
ForcePlayerStartLocation(Player(9), 9)
SetPlayerColor(Player(9), ConvertPlayerColor(9))
SetPlayerRacePreference(Player(9), RACE_PREF_HUMAN)
SetPlayerRaceSelectable(Player(9), false)
SetPlayerController(Player(9), MAP_CONTROL_USER)
SetPlayerStartLocation(Player(10), 10)
SetPlayerColor(Player(10), ConvertPlayerColor(10))
SetPlayerRacePreference(Player(10), RACE_PREF_RANDOM)
SetPlayerRaceSelectable(Player(10), true)
SetPlayerController(Player(10), MAP_CONTROL_COMPUTER)
SetPlayerStartLocation(Player(11), 11)
SetPlayerColor(Player(11), ConvertPlayerColor(11))
SetPlayerRacePreference(Player(11), RACE_PREF_RANDOM)
SetPlayerRaceSelectable(Player(11), true)
SetPlayerController(Player(11), MAP_CONTROL_COMPUTER)
SetPlayerStartLocation(Player(12), 12)
SetPlayerColor(Player(12), ConvertPlayerColor(12))
SetPlayerRacePreference(Player(12), RACE_PREF_RANDOM)
SetPlayerRaceSelectable(Player(12), true)
SetPlayerController(Player(12), MAP_CONTROL_COMPUTER)
SetPlayerStartLocation(Player(13), 13)
SetPlayerColor(Player(13), ConvertPlayerColor(13))
SetPlayerRacePreference(Player(13), RACE_PREF_RANDOM)
SetPlayerRaceSelectable(Player(13), true)
SetPlayerController(Player(13), MAP_CONTROL_COMPUTER)
SetPlayerStartLocation(Player(14), 14)
SetPlayerColor(Player(14), ConvertPlayerColor(14))
SetPlayerRacePreference(Player(14), RACE_PREF_RANDOM)
SetPlayerRaceSelectable(Player(14), true)
SetPlayerController(Player(14), MAP_CONTROL_COMPUTER)
SetPlayerStartLocation(Player(15), 15)
SetPlayerColor(Player(15), ConvertPlayerColor(15))
SetPlayerRacePreference(Player(15), RACE_PREF_RANDOM)
SetPlayerRaceSelectable(Player(15), true)
SetPlayerController(Player(15), MAP_CONTROL_COMPUTER)
SetPlayerStartLocation(Player(16), 16)
SetPlayerColor(Player(16), ConvertPlayerColor(16))
SetPlayerRacePreference(Player(16), RACE_PREF_RANDOM)
SetPlayerRaceSelectable(Player(16), true)
SetPlayerController(Player(16), MAP_CONTROL_COMPUTER)
SetPlayerStartLocation(Player(17), 17)
SetPlayerColor(Player(17), ConvertPlayerColor(17))
SetPlayerRacePreference(Player(17), RACE_PREF_RANDOM)
SetPlayerRaceSelectable(Player(17), true)
SetPlayerController(Player(17), MAP_CONTROL_COMPUTER)
SetPlayerStartLocation(Player(18), 18)
SetPlayerColor(Player(18), ConvertPlayerColor(18))
SetPlayerRacePreference(Player(18), RACE_PREF_RANDOM)
SetPlayerRaceSelectable(Player(18), true)
SetPlayerController(Player(18), MAP_CONTROL_COMPUTER)
SetPlayerStartLocation(Player(19), 19)
SetPlayerColor(Player(19), ConvertPlayerColor(19))
SetPlayerRacePreference(Player(19), RACE_PREF_RANDOM)
SetPlayerRaceSelectable(Player(19), true)
SetPlayerController(Player(19), MAP_CONTROL_COMPUTER)
end

function InitCustomTeams()
SetPlayerTeam(Player(0), 0)
SetPlayerTeam(Player(2), 0)
SetPlayerTeam(Player(3), 0)
SetPlayerTeam(Player(4), 0)
SetPlayerTeam(Player(5), 0)
SetPlayerTeam(Player(1), 1)
SetPlayerTeam(Player(6), 1)
SetPlayerTeam(Player(7), 1)
SetPlayerTeam(Player(8), 1)
SetPlayerTeam(Player(9), 1)
SetPlayerAllianceStateAllyBJ(Player(1), Player(6), true)
SetPlayerAllianceStateAllyBJ(Player(1), Player(7), true)
SetPlayerAllianceStateAllyBJ(Player(1), Player(8), true)
SetPlayerAllianceStateAllyBJ(Player(1), Player(9), true)
SetPlayerAllianceStateAllyBJ(Player(6), Player(1), true)
SetPlayerAllianceStateAllyBJ(Player(6), Player(7), true)
SetPlayerAllianceStateAllyBJ(Player(6), Player(8), true)
SetPlayerAllianceStateAllyBJ(Player(6), Player(9), true)
SetPlayerAllianceStateAllyBJ(Player(7), Player(1), true)
SetPlayerAllianceStateAllyBJ(Player(7), Player(6), true)
SetPlayerAllianceStateAllyBJ(Player(7), Player(8), true)
SetPlayerAllianceStateAllyBJ(Player(7), Player(9), true)
SetPlayerAllianceStateAllyBJ(Player(8), Player(1), true)
SetPlayerAllianceStateAllyBJ(Player(8), Player(6), true)
SetPlayerAllianceStateAllyBJ(Player(8), Player(7), true)
SetPlayerAllianceStateAllyBJ(Player(8), Player(9), true)
SetPlayerAllianceStateAllyBJ(Player(9), Player(1), true)
SetPlayerAllianceStateAllyBJ(Player(9), Player(6), true)
SetPlayerAllianceStateAllyBJ(Player(9), Player(7), true)
SetPlayerAllianceStateAllyBJ(Player(9), Player(8), true)
SetPlayerAllianceStateVisionBJ(Player(1), Player(6), true)
SetPlayerAllianceStateVisionBJ(Player(1), Player(7), true)
SetPlayerAllianceStateVisionBJ(Player(1), Player(8), true)
SetPlayerAllianceStateVisionBJ(Player(1), Player(9), true)
SetPlayerAllianceStateVisionBJ(Player(6), Player(1), true)
SetPlayerAllianceStateVisionBJ(Player(6), Player(7), true)
SetPlayerAllianceStateVisionBJ(Player(6), Player(8), true)
SetPlayerAllianceStateVisionBJ(Player(6), Player(9), true)
SetPlayerAllianceStateVisionBJ(Player(7), Player(1), true)
SetPlayerAllianceStateVisionBJ(Player(7), Player(6), true)
SetPlayerAllianceStateVisionBJ(Player(7), Player(8), true)
SetPlayerAllianceStateVisionBJ(Player(7), Player(9), true)
SetPlayerAllianceStateVisionBJ(Player(8), Player(1), true)
SetPlayerAllianceStateVisionBJ(Player(8), Player(6), true)
SetPlayerAllianceStateVisionBJ(Player(8), Player(7), true)
SetPlayerAllianceStateVisionBJ(Player(8), Player(9), true)
SetPlayerAllianceStateVisionBJ(Player(9), Player(1), true)
SetPlayerAllianceStateVisionBJ(Player(9), Player(6), true)
SetPlayerAllianceStateVisionBJ(Player(9), Player(7), true)
SetPlayerAllianceStateVisionBJ(Player(9), Player(8), true)
SetPlayerTeam(Player(10), 2)
SetPlayerTeam(Player(11), 2)
SetPlayerTeam(Player(12), 2)
SetPlayerTeam(Player(13), 2)
SetPlayerTeam(Player(14), 2)
SetPlayerAllianceStateAllyBJ(Player(10), Player(11), true)
SetPlayerAllianceStateAllyBJ(Player(10), Player(12), true)
SetPlayerAllianceStateAllyBJ(Player(10), Player(13), true)
SetPlayerAllianceStateAllyBJ(Player(10), Player(14), true)
SetPlayerAllianceStateAllyBJ(Player(11), Player(10), true)
SetPlayerAllianceStateAllyBJ(Player(11), Player(12), true)
SetPlayerAllianceStateAllyBJ(Player(11), Player(13), true)
SetPlayerAllianceStateAllyBJ(Player(11), Player(14), true)
SetPlayerAllianceStateAllyBJ(Player(12), Player(10), true)
SetPlayerAllianceStateAllyBJ(Player(12), Player(11), true)
SetPlayerAllianceStateAllyBJ(Player(12), Player(13), true)
SetPlayerAllianceStateAllyBJ(Player(12), Player(14), true)
SetPlayerAllianceStateAllyBJ(Player(13), Player(10), true)
SetPlayerAllianceStateAllyBJ(Player(13), Player(11), true)
SetPlayerAllianceStateAllyBJ(Player(13), Player(12), true)
SetPlayerAllianceStateAllyBJ(Player(13), Player(14), true)
SetPlayerAllianceStateAllyBJ(Player(14), Player(10), true)
SetPlayerAllianceStateAllyBJ(Player(14), Player(11), true)
SetPlayerAllianceStateAllyBJ(Player(14), Player(12), true)
SetPlayerAllianceStateAllyBJ(Player(14), Player(13), true)
SetPlayerAllianceStateVisionBJ(Player(10), Player(11), true)
SetPlayerAllianceStateVisionBJ(Player(10), Player(12), true)
SetPlayerAllianceStateVisionBJ(Player(10), Player(13), true)
SetPlayerAllianceStateVisionBJ(Player(10), Player(14), true)
SetPlayerAllianceStateVisionBJ(Player(11), Player(10), true)
SetPlayerAllianceStateVisionBJ(Player(11), Player(12), true)
SetPlayerAllianceStateVisionBJ(Player(11), Player(13), true)
SetPlayerAllianceStateVisionBJ(Player(11), Player(14), true)
SetPlayerAllianceStateVisionBJ(Player(12), Player(10), true)
SetPlayerAllianceStateVisionBJ(Player(12), Player(11), true)
SetPlayerAllianceStateVisionBJ(Player(12), Player(13), true)
SetPlayerAllianceStateVisionBJ(Player(12), Player(14), true)
SetPlayerAllianceStateVisionBJ(Player(13), Player(10), true)
SetPlayerAllianceStateVisionBJ(Player(13), Player(11), true)
SetPlayerAllianceStateVisionBJ(Player(13), Player(12), true)
SetPlayerAllianceStateVisionBJ(Player(13), Player(14), true)
SetPlayerAllianceStateVisionBJ(Player(14), Player(10), true)
SetPlayerAllianceStateVisionBJ(Player(14), Player(11), true)
SetPlayerAllianceStateVisionBJ(Player(14), Player(12), true)
SetPlayerAllianceStateVisionBJ(Player(14), Player(13), true)
SetPlayerTeam(Player(15), 3)
SetPlayerTeam(Player(16), 3)
SetPlayerTeam(Player(17), 3)
SetPlayerTeam(Player(18), 3)
SetPlayerTeam(Player(19), 3)
SetPlayerAllianceStateAllyBJ(Player(15), Player(16), true)
SetPlayerAllianceStateAllyBJ(Player(15), Player(17), true)
SetPlayerAllianceStateAllyBJ(Player(15), Player(18), true)
SetPlayerAllianceStateAllyBJ(Player(15), Player(19), true)
SetPlayerAllianceStateAllyBJ(Player(16), Player(15), true)
SetPlayerAllianceStateAllyBJ(Player(16), Player(17), true)
SetPlayerAllianceStateAllyBJ(Player(16), Player(18), true)
SetPlayerAllianceStateAllyBJ(Player(16), Player(19), true)
SetPlayerAllianceStateAllyBJ(Player(17), Player(15), true)
SetPlayerAllianceStateAllyBJ(Player(17), Player(16), true)
SetPlayerAllianceStateAllyBJ(Player(17), Player(18), true)
SetPlayerAllianceStateAllyBJ(Player(17), Player(19), true)
SetPlayerAllianceStateAllyBJ(Player(18), Player(15), true)
SetPlayerAllianceStateAllyBJ(Player(18), Player(16), true)
SetPlayerAllianceStateAllyBJ(Player(18), Player(17), true)
SetPlayerAllianceStateAllyBJ(Player(18), Player(19), true)
SetPlayerAllianceStateAllyBJ(Player(19), Player(15), true)
SetPlayerAllianceStateAllyBJ(Player(19), Player(16), true)
SetPlayerAllianceStateAllyBJ(Player(19), Player(17), true)
SetPlayerAllianceStateAllyBJ(Player(19), Player(18), true)
SetPlayerAllianceStateVisionBJ(Player(15), Player(16), true)
SetPlayerAllianceStateVisionBJ(Player(15), Player(17), true)
SetPlayerAllianceStateVisionBJ(Player(15), Player(18), true)
SetPlayerAllianceStateVisionBJ(Player(15), Player(19), true)
SetPlayerAllianceStateVisionBJ(Player(16), Player(15), true)
SetPlayerAllianceStateVisionBJ(Player(16), Player(17), true)
SetPlayerAllianceStateVisionBJ(Player(16), Player(18), true)
SetPlayerAllianceStateVisionBJ(Player(16), Player(19), true)
SetPlayerAllianceStateVisionBJ(Player(17), Player(15), true)
SetPlayerAllianceStateVisionBJ(Player(17), Player(16), true)
SetPlayerAllianceStateVisionBJ(Player(17), Player(18), true)
SetPlayerAllianceStateVisionBJ(Player(17), Player(19), true)
SetPlayerAllianceStateVisionBJ(Player(18), Player(15), true)
SetPlayerAllianceStateVisionBJ(Player(18), Player(16), true)
SetPlayerAllianceStateVisionBJ(Player(18), Player(17), true)
SetPlayerAllianceStateVisionBJ(Player(18), Player(19), true)
SetPlayerAllianceStateVisionBJ(Player(19), Player(15), true)
SetPlayerAllianceStateVisionBJ(Player(19), Player(16), true)
SetPlayerAllianceStateVisionBJ(Player(19), Player(17), true)
SetPlayerAllianceStateVisionBJ(Player(19), Player(18), true)
end

function InitAllyPriorities()
SetStartLocPrioCount(0, 9)
SetStartLocPrio(0, 0, 1, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(0, 1, 2, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(0, 2, 3, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(0, 3, 4, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(0, 4, 5, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(0, 5, 6, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(0, 6, 7, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(0, 7, 8, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(0, 8, 9, MAP_LOC_PRIO_HIGH)
SetStartLocPrioCount(1, 9)
SetStartLocPrio(1, 0, 0, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(1, 1, 2, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(1, 2, 3, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(1, 3, 4, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(1, 4, 5, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(1, 5, 6, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(1, 6, 7, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(1, 7, 8, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(1, 8, 9, MAP_LOC_PRIO_HIGH)
SetStartLocPrioCount(2, 9)
SetStartLocPrio(2, 0, 0, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(2, 1, 1, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(2, 2, 3, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(2, 3, 4, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(2, 4, 5, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(2, 5, 6, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(2, 6, 7, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(2, 7, 8, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(2, 8, 9, MAP_LOC_PRIO_HIGH)
SetStartLocPrioCount(3, 9)
SetStartLocPrio(3, 0, 0, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(3, 1, 1, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(3, 2, 2, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(3, 3, 4, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(3, 4, 5, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(3, 5, 6, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(3, 6, 7, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(3, 7, 8, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(3, 8, 9, MAP_LOC_PRIO_HIGH)
SetStartLocPrioCount(4, 9)
SetStartLocPrio(4, 0, 0, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(4, 1, 1, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(4, 2, 2, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(4, 3, 3, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(4, 4, 5, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(4, 5, 6, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(4, 6, 7, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(4, 7, 8, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(4, 8, 9, MAP_LOC_PRIO_HIGH)
SetStartLocPrioCount(5, 9)
SetStartLocPrio(5, 0, 0, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(5, 1, 1, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(5, 2, 2, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(5, 3, 3, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(5, 4, 4, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(5, 5, 6, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(5, 6, 7, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(5, 7, 8, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(5, 8, 9, MAP_LOC_PRIO_HIGH)
SetStartLocPrioCount(6, 9)
SetStartLocPrio(6, 0, 0, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(6, 1, 1, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(6, 2, 2, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(6, 3, 3, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(6, 4, 4, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(6, 5, 5, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(6, 6, 7, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(6, 7, 8, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(6, 8, 9, MAP_LOC_PRIO_HIGH)
SetStartLocPrioCount(7, 9)
SetStartLocPrio(7, 0, 0, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(7, 1, 1, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(7, 2, 2, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(7, 3, 3, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(7, 4, 4, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(7, 5, 5, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(7, 6, 6, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(7, 7, 8, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(7, 8, 9, MAP_LOC_PRIO_HIGH)
SetStartLocPrioCount(8, 9)
SetStartLocPrio(8, 0, 0, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(8, 1, 1, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(8, 2, 2, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(8, 3, 3, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(8, 4, 4, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(8, 5, 5, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(8, 6, 6, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(8, 7, 7, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(8, 8, 9, MAP_LOC_PRIO_HIGH)
SetStartLocPrioCount(9, 9)
SetStartLocPrio(9, 0, 0, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(9, 1, 1, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(9, 2, 2, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(9, 3, 3, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(9, 4, 4, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(9, 5, 5, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(9, 6, 6, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(9, 7, 7, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(9, 8, 8, MAP_LOC_PRIO_HIGH)
SetStartLocPrioCount(10, 3)
SetStartLocPrio(10, 0, 4, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(10, 1, 17, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(10, 2, 19, MAP_LOC_PRIO_HIGH)
SetEnemyStartLocPrioCount(10, 1)
SetEnemyStartLocPrio(10, 0, 18, MAP_LOC_PRIO_LOW)
SetStartLocPrioCount(11, 4)
SetStartLocPrio(11, 0, 0, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(11, 1, 4, MAP_LOC_PRIO_LOW)
SetStartLocPrio(11, 2, 18, MAP_LOC_PRIO_LOW)
SetStartLocPrio(11, 3, 19, MAP_LOC_PRIO_LOW)
SetEnemyStartLocPrioCount(11, 3)
SetEnemyStartLocPrio(11, 0, 4, MAP_LOC_PRIO_LOW)
SetEnemyStartLocPrio(11, 1, 17, MAP_LOC_PRIO_LOW)
SetEnemyStartLocPrio(11, 2, 19, MAP_LOC_PRIO_LOW)
SetStartLocPrioCount(12, 3)
SetStartLocPrio(12, 0, 17, MAP_LOC_PRIO_LOW)
SetStartLocPrio(12, 1, 18, MAP_LOC_PRIO_LOW)
SetStartLocPrio(12, 2, 19, MAP_LOC_PRIO_LOW)
SetEnemyStartLocPrioCount(12, 3)
SetEnemyStartLocPrio(12, 0, 1, MAP_LOC_PRIO_HIGH)
SetEnemyStartLocPrio(12, 1, 18, MAP_LOC_PRIO_HIGH)
SetEnemyStartLocPrio(12, 2, 19, MAP_LOC_PRIO_HIGH)
SetStartLocPrioCount(13, 1)
SetStartLocPrio(13, 0, 0, MAP_LOC_PRIO_LOW)
SetEnemyStartLocPrioCount(13, 2)
SetEnemyStartLocPrio(13, 0, 4, MAP_LOC_PRIO_LOW)
SetEnemyStartLocPrio(13, 1, 18, MAP_LOC_PRIO_LOW)
SetStartLocPrioCount(14, 2)
SetStartLocPrio(14, 0, 8, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(14, 1, 9, MAP_LOC_PRIO_HIGH)
SetEnemyStartLocPrioCount(14, 2)
SetEnemyStartLocPrio(14, 0, 4, MAP_LOC_PRIO_HIGH)
SetEnemyStartLocPrio(14, 1, 19, MAP_LOC_PRIO_HIGH)
SetStartLocPrioCount(15, 1)
SetStartLocPrio(15, 0, 17, MAP_LOC_PRIO_HIGH)
SetEnemyStartLocPrioCount(15, 3)
SetEnemyStartLocPrio(15, 0, 1, MAP_LOC_PRIO_LOW)
SetEnemyStartLocPrio(15, 1, 18, MAP_LOC_PRIO_LOW)
SetEnemyStartLocPrio(15, 2, 19, MAP_LOC_PRIO_LOW)
SetStartLocPrioCount(16, 1)
SetStartLocPrio(16, 0, 19, MAP_LOC_PRIO_LOW)
SetEnemyStartLocPrioCount(16, 3)
SetEnemyStartLocPrio(16, 0, 4, MAP_LOC_PRIO_HIGH)
SetEnemyStartLocPrio(16, 1, 18, MAP_LOC_PRIO_LOW)
SetEnemyStartLocPrio(16, 2, 19, MAP_LOC_PRIO_HIGH)
SetStartLocPrioCount(17, 3)
SetStartLocPrio(17, 0, 4, MAP_LOC_PRIO_LOW)
SetStartLocPrio(17, 1, 18, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(17, 2, 19, MAP_LOC_PRIO_LOW)
SetEnemyStartLocPrioCount(17, 2)
SetEnemyStartLocPrio(17, 0, 18, MAP_LOC_PRIO_HIGH)
SetStartLocPrioCount(18, 2)
SetStartLocPrio(18, 0, 0, MAP_LOC_PRIO_HIGH)
SetStartLocPrio(18, 1, 17, MAP_LOC_PRIO_HIGH)
SetEnemyStartLocPrioCount(18, 1)
SetStartLocPrioCount(19, 1)
SetStartLocPrio(19, 0, 18, MAP_LOC_PRIO_LOW)
SetEnemyStartLocPrioCount(19, 1)
SetEnemyStartLocPrio(19, 0, 18, MAP_LOC_PRIO_LOW)
end

function main()
SetCameraBounds(-16128.0 + GetCameraMargin(CAMERA_MARGIN_LEFT), 1024.0 + GetCameraMargin(CAMERA_MARGIN_BOTTOM), 2688.0 - GetCameraMargin(CAMERA_MARGIN_RIGHT), 11264.0 - GetCameraMargin(CAMERA_MARGIN_TOP), -16128.0 + GetCameraMargin(CAMERA_MARGIN_LEFT), 11264.0 - GetCameraMargin(CAMERA_MARGIN_TOP), 2688.0 - GetCameraMargin(CAMERA_MARGIN_RIGHT), 1024.0 + GetCameraMargin(CAMERA_MARGIN_BOTTOM))
SetDayNightModels("Environment\\DNC\\DNCLordaeron\\DNCLordaeronTerrain\\DNCLordaeronTerrain.mdl", "Environment\\DNC\\DNCLordaeron\\DNCLordaeronUnit\\DNCLordaeronUnit.mdl")
NewSoundEnvironment("Default")
SetAmbientDaySound("LordaeronSummerDay")
SetAmbientNightSound("LordaeronSummerNight")
SetMapMusic("Music", true, 0)
CreateRegions()
InitBlizzard()
InitGlobals()
end

function config()
SetMapName("TRIGSTR_001")
SetMapDescription("TRIGSTR_003")
SetPlayers(20)
SetTeams(20)
SetGamePlacement(MAP_PLACEMENT_TEAMS_TOGETHER)
DefineStartLocation(0, -15872.0, 11008.0)
DefineStartLocation(1, -15872.0, 11008.0)
DefineStartLocation(2, -15872.0, 11008.0)
DefineStartLocation(3, -15872.0, 11008.0)
DefineStartLocation(4, -15872.0, 11008.0)
DefineStartLocation(5, -15872.0, 11008.0)
DefineStartLocation(6, -15872.0, 11008.0)
DefineStartLocation(7, -15872.0, 11008.0)
DefineStartLocation(8, -15872.0, 11008.0)
DefineStartLocation(9, -15872.0, 11008.0)
DefineStartLocation(10, -15808.0, 11008.0)
DefineStartLocation(11, -15872.0, 11008.0)
DefineStartLocation(12, -15872.0, 11008.0)
DefineStartLocation(13, -15872.0, 11008.0)
DefineStartLocation(14, -15872.0, 11008.0)
DefineStartLocation(15, -15872.0, 11008.0)
DefineStartLocation(16, -15872.0, 11008.0)
DefineStartLocation(17, -15872.0, 11008.0)
DefineStartLocation(18, -15872.0, 11008.0)
DefineStartLocation(19, -15872.0, 11008.0)
InitCustomPlayerSlots()
InitCustomTeams()
InitAllyPriorities()
end

